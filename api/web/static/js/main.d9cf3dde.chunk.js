(this["webpackJsonpreact-dnd"]=this["webpackJsonpreact-dnd"]||[]).push([[0],{48:function(e,t,n){},53:function(e,t,n){e.exports=n(86)},55:function(e,t,n){},60:function(e,t,n){},61:function(e,t,n){},62:function(e,t,n){},68:function(e,t,n){},69:function(e,t,n){},70:function(e,t,n){},71:function(e,t,n){},72:function(e,t,n){},75:function(e,t,n){var a={"./ckb.js":25,"./da.js":26,"./de.js":27,"./en.js":18,"./es.js":28,"./fr.js":29,"./he.js":30,"./index.js":76,"./it.js":31,"./ja.js":32,"./ko.js":33,"./lv.js":34,"./nl.js":35,"./pl.js":36,"./pt_br.js":37,"./ro.js":38,"./ru.js":39,"./se.js":40,"./ua.js":41,"./zh_cn.js":42};function r(e){var t=o(e);return n(t)}function o(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}r.keys=function(){return Object.keys(a)},r.resolve=o,e.exports=r,r.id=75},78:function(e,t,n){},79:function(e,t,n){},81:function(e,t,n){},82:function(e,t,n){},83:function(e,t,n){},84:function(e,t,n){},85:function(e,t,n){},86:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),o=n(9),l=(n(55),n(0)),c=n.n(l),i=n(49),u=n.n(i),s=n(4),m=(n(60),n(61),n(11)),d=n(5),f=n(10),p=(n(62),[{name:"5e Tools",url:"https://5e.tools/"},{name:"Bestiario (5e Tools)",url:"https://5e.tools/bestiary.html"},{name:"Objetos mundanos y m\xe1gicos (5e Tools)",url:"https://5e.tools/items.html"},{name:"Calculadora de encuentros",url:"https://kastark.co.uk/rpgs/encounter-calculator-5th/"},{name:"Tabla de encuentros aleatorios (5e Tools)",url:"https://5e.tools/encountergen.html"},{name:"Generador de nombres",url:"https://www.fantasynamegen.com/"},{name:"Razas",url:"https://www.dndbeyond.com/races"},{name:"Clases",url:"https://www.dndbeyond.com/classes"}]),v=n(3),E=n(2);function h(){return c.a.createElement(E.a,{icon:v.d,color:"#72b52f"})}function g(){return c.a.createElement(E.a,{icon:v.j,color:"#6942f5"})}var b=n(6),y=n(7),k=n(90),C=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,null,[{key:"generateId",value:function(){return Object(k.a)()}}]),e}(),j=n(13),O=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,null,[{key:"moveElementInArray",value:function(e,t,n){if(n>=e.length)for(var a=n-e.length+1;a--;)e.push(void 0);e.splice(n,0,e.splice(t,1)[0])}}]),e}(),x=n(22),w=n(16),_=n(15),B=n(14),N=function(){function e(t,n){Object(b.a)(this,e),this.id=null,this.name=null,this.type=null,this.id=C.generateId(),this.name=t,this.type=n}return Object(y.a)(e,[{key:"toJson",value:function(){return{id:this.id,name:this.name,type:this.type}}}],[{key:"fromJson",value:function(e){throw Error("This method should not be used!")}}]),e}();N.TYPES={PARAGRAPH:"paragraph",CONTAINER:"container",SHOP:"shop"};var D=function(e){Object(_.a)(n,e);var t=Object(B.a)(n);function n(e){var a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Object(b.a)(this,n),(a=t.call(this,e,N.TYPES.PARAGRAPH)).body=null,a.body=r,a}return Object(y.a)(n,[{key:"toJson",value:function(){var e=Object(x.a)(Object(w.a)(n.prototype),"toJson",this).call(this);return e.body=this.body,e}}],[{key:"fromJson",value:function(e){return new n(e.name,e.body)}}]),n}(N),S=function(e){Object(_.a)(n,e);var t=Object(B.a)(n);function n(e){var a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(b.a)(this,n),(a=t.call(this,e,N.TYPES.CONTAINER)).elements=null,a.elements=r,a}return Object(y.a)(n,[{key:"getElement",value:function(e){return this.elements.find((function(t){return t.id===e}))}},{key:"addElement",value:function(e){this.elements.push(e)}},{key:"removeElement",value:function(e){var t=this.getElement(e);this.elements.splice(this.elements.indexOf(t),1)}},{key:"moveElementUp",value:function(e){var t=this.elements.indexOf(this.elements.find((function(t){return t.id===e}))),n=t-1;0!==t&&O.moveElementInArray(this.elements,t,n)}},{key:"moveElementDown",value:function(e){var t=this.elements.indexOf(this.elements.find((function(t){return t.id===e}))),n=t+1;n!==this.elements.length&&O.moveElementInArray(this.elements,t,n)}},{key:"findInChild",value:function(e){var t,n=Object(j.a)(this.elements);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a.id===e)return a;if(a.findInChild){var r=a.findInChild(e);if(r)return r}}}catch(o){n.e(o)}finally{n.f()}return null}},{key:"getPlainViewableElements",value:function(){var e,t=[],n=Object(j.a)(this.elements);try{for(n.s();!(e=n.n()).done;){var a=e.value;a.type===N.TYPES.CONTAINER?t=t.concat(a.getPlainViewableElements()):t.push(a)}}catch(r){n.e(r)}finally{n.f()}return t}},{key:"toJson",value:function(){var e=Object(x.a)(Object(w.a)(n.prototype),"toJson",this).call(this);return e.elements=this.elements.map((function(e){return e.toJson()})),e}}],[{key:"fromJson",value:function(e){return new n(e.name,(e.elements||[]).map((function(e){return A.mapElementFromJson(e)})))}}]),n}(N),I=function(){function e(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(b.a)(this,e),this.id=null,this.title=null,this.price=null,this.link=null,this.amount=0,this.id=C.generateId(),this.title=t,this.price=n,this.link=a,this.amount=r}return Object(y.a)(e,[{key:"clone",value:function(){return e.fromJson(this.toJson())}},{key:"toJson",value:function(){return{id:this.id,title:this.title,price:this.price,link:this.link,amount:this.amount}}}],[{key:"fromJson",value:function(t){var n=new e(t.title,t.price,t.link,t.amount);return n.id=t.id,n}}]),e}(),T=function(e){Object(_.a)(n,e);var t=Object(B.a)(n);function n(e){var a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(b.a)(this,n),(a=t.call(this,e,N.TYPES.SHOP)).items=null,a.items=r,a}return Object(y.a)(n,[{key:"toJson",value:function(){var e=Object(x.a)(Object(w.a)(n.prototype),"toJson",this).call(this);return e.items=this.items.map((function(e){return e.toJson()})),e}}],[{key:"fromJson",value:function(e){return new n(e.name,e.items.map((function(e){return I.fromJson(e)})))}}]),n}(N),A=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,null,[{key:"mapElementFromJson",value:function(e){var t=this._ELEMENT_TYPES_MAPPING[e.type].fromJson(e);return t.id=e.id,t}},{key:"createElement",value:function(e,t){return new this._ELEMENT_TYPES_MAPPING[t](e)}}]),e}();A._ELEMENT_TYPES_MAPPING={paragraph:D,container:S,shop:T};var P=function(){function e(t){Object(b.a)(this,e),this.id=null,this.type=null,this.elements=null,this.id=C.generateId(),this.name=t,this.elements=[]}return Object(y.a)(e,[{key:"getElement",value:function(e){return this.elements.find((function(t){return t.id===e}))}},{key:"findElementAnywhere",value:function(e){var t,n=Object(j.a)(this.elements);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a.id===e)return a;if(a.findInChild){var r=a.findInChild(e);if(r)return r}}}catch(o){n.e(o)}finally{n.f()}return null}},{key:"addElement",value:function(e){this.elements.push(e)}},{key:"removeElement",value:function(e){var t=this.getElement(e);this.elements.splice(this.elements.indexOf(t),1)}},{key:"moveElementUp",value:function(e){var t=this.elements.indexOf(this.elements.find((function(t){return t.id===e}))),n=t-1;0!==t&&O.moveElementInArray(this.elements,t,n)}},{key:"moveElementDown",value:function(e){var t=this.elements.indexOf(this.elements.find((function(t){return t.id===e}))),n=t+1;n!==this.elements.length&&O.moveElementInArray(this.elements,t,n)}},{key:"_getPlainViewableElements",value:function(){var e,t=[],n=Object(j.a)(this.elements);try{for(n.s();!(e=n.n()).done;){var a=e.value;a.type===N.TYPES.CONTAINER?t=t.concat(a.getPlainViewableElements()):t.push(a)}}catch(r){n.e(r)}finally{n.f()}return t}},{key:"getPrevElement",value:function(e){var t=this._getPlainViewableElements(),n=t.indexOf(t.find((function(t){return t.id===e})));return 0===n?null:t[n-1]}},{key:"getNextElement",value:function(e){var t=this._getPlainViewableElements(),n=t.indexOf(t.find((function(t){return t.id===e})));return n===t.length-1?null:t[n+1]}},{key:"toJson",value:function(){return{id:this.id,name:this.name,elements:this.elements.map((function(e){return e.toJson()}))}}}],[{key:"fromJson",value:function(t){var n=new e(t.name);return n.id=t.id,n.elements=t.elements.map((function(e){return A.mapElementFromJson(e)})),n}}]),e}(),R=function(){function e(t,n){if(Object(b.a)(this,e),this.id=null,this.type=null,this.name=null,this.categories=null,!e.TYPES.find((function(e){return e.type===t})))throw Error("Invalid type");this.id=C.generateId(),this.type=t,this.name=n,this.categories=[]}return Object(y.a)(e,[{key:"getNarrativeCategory",value:function(e){return this.categories.find((function(t){return t.id===e}))}},{key:"addNarrativeCategory",value:function(e){this.categories.push(e)}},{key:"removeNarrativeCategory",value:function(e){var t=this.getNarrativeCategory(e);this.categories.splice(this.categories.indexOf(t),1)}},{key:"moveNarrativeCategoryUp",value:function(e){var t=this.categories.indexOf(this.categories.find((function(t){return t.id===e}))),n=t-1;0!==t&&O.moveElementInArray(this.categories,t,n)}},{key:"moveNarrativeCategoryDown",value:function(e){var t=this.categories.indexOf(this.categories.find((function(t){return t.id===e}))),n=t+1;n!==this.categories.length&&O.moveElementInArray(this.categories,t,n)}},{key:"toJson",value:function(){return{id:this.id,type:this.type,name:this.name,categories:this.categories.map((function(e){return e.toJson()}))}}}],[{key:"fromJson",value:function(t){var n=new e(t.type,t.name);return n.id=t.id,n.categories=t.categories.map((function(e){return P.fromJson(e)})),n}}]),e}();R.TYPES=[{type:"world",name:"Mundo"},{type:"campaign",name:"Campa\xf1a"}];var U=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,null,[{key:"importFromJson",value:function(e,t){var n=null;try{n=R.fromJson(JSON.parse(e))}catch(a){return void alert("Ha ocurrido un error al importar el contexto narrativo. El formato del archivo no parece ser v\xe1lido!")}t.getDB().getNarrativeContext(n.id)?alert("Ha ocurrido un error al importar el contexto narrativo. Parece ser que posees otro contexto narrativo con el mismo identificador!"):(t.getDB().addNarrativeContext(n),alert("La importaci\xf3n fue realizada con \xe9xito!"),t.saveDB())}}]),e}();function J(e){var t=e.appContext,n=Object(d.g)(),a=Object(l.useState)([]),i=Object(s.a)(a,2),u=i[0],v=i[1],E=Object(l.useState)([]),b=Object(s.a)(E,2),y=b[0],k=b[1];Object(l.useEffect)((function(){t.setNarrativeContextById(null),t.setBackButtonUrl(null),t.setForwardButtonUrl(null);var e=t.getDB();v(e.campaigns),k(e.worlds)}),[t]);var C=function(){var e=Object(o.a)(r.a.mark((function e(n){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.preventDefault(),(a=new FileReader).onload=function(){var e=Object(o.a)(r.a.mark((function e(n){var a,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n.target.result,U.importFromJson(a,t),o=t.getDB(),v(Object(f.a)(o.campaigns)),k(Object(f.a)(o.worlds)),setTimeout((function(){v(o.campaigns),k(o.worlds)}),0),document.getElementById("narrativeContextFileSelector").value=null;case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.readAsText(n.target.files[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return c.a.createElement("div",null,c.a.createElement("div",{className:"homeTitleSection"},c.a.createElement("h1",{className:"flex1"},"Contextos narrativos"),c.a.createElement("div",{className:"homeTitleButtons"},c.a.createElement("button",{onClick:function(){n("/create-narrative-context")}},c.a.createElement(h,null)," Crear"),c.a.createElement("input",{type:"file",id:"narrativeContextFileSelector",hidden:!0,onChange:C,accept:"application/json"}),c.a.createElement("button",{onClick:function(){return document.getElementById("narrativeContextFileSelector").click()}},c.a.createElement(g,null)," Importar"))),c.a.createElement("h2",null,c.a.createElement("span",{role:"img","aria-label":"books"},"\ud83d\udcda")," Campa\xf1as"),c.a.createElement("ul",null,u.map((function(e){return c.a.createElement("li",{key:e.id},c.a.createElement(m.b,{to:"/narrative-context/".concat(e.id)},e.name))}))),c.a.createElement("h2",null,c.a.createElement("span",{role:"img","aria-label":"world"},"\ud83c\udf0e")," Mundos"),c.a.createElement("ul",null,y.map((function(e){return c.a.createElement("li",{key:e.id},c.a.createElement(m.b,{to:"/narrative-context/".concat(e.id)},e.name))}))),c.a.createElement("h2",null,c.a.createElement("span",{role:"img","aria-label":"tools"},"\u2692\ufe0f")," Herramientas"),c.a.createElement("ul",null,p.map((function(e){return c.a.createElement("li",{key:e.name},c.a.createElement("a",{href:e.url},e.name))}))))}function F(e){var t=e.appContext,n=Object(d.g)(),a=Object(l.useState)(),r=Object(s.a)(a,2),o=r[0],i=r[1],u=Object(l.useState)(R.TYPES[0].type),m=Object(s.a)(u,2),f=m[0],p=m[1];Object(l.useEffect)((function(){t.setNarrativeContextById(null)}),[t]);return c.a.createElement("div",null,c.a.createElement("h1",null,"Crear contexto narrativo"),c.a.createElement("input",{type:"text",placeholder:"Nombre",onChange:function(e){return i(e.target.value)}}),c.a.createElement("select",{onChange:function(e){return p(e.target.value)}},R.TYPES.map((function(e){return c.a.createElement("option",{key:e.type,value:e.type},e.name)}))),c.a.createElement("button",{onClick:function(){var e=new R(f,o);t.getDB().addNarrativeContext(e),t.saveDB(),n("/")}},"Crear"))}var L=n(44);n(68),n(69),n(70);function H(){return c.a.createElement(E.a,{icon:v.o,color:"#2b3340"})}function Y(){return c.a.createElement(E.a,{icon:v.p,color:"#baa28f"})}function M(){return c.a.createElement(E.a,{icon:v.k,color:"#FACC30"})}function V(){return c.a.createElement(E.a,{icon:v.q,color:"#609fbf"})}function z(e){var t=e.onClick,n=void 0===t?function(e){}:t,a=Object(l.useRef)(),r=function(e){a.current.classList.toggle("showDropdownBody"),n(e)};return c.a.createElement("div",{className:"CreateElementButton"},c.a.createElement("button",{onClick:function(){a.current.classList.toggle("showDropdownBody")}},c.a.createElement(H,null),c.a.createElement("span",{className:"tooltip"},"Crear elemento")),c.a.createElement("div",{ref:a,className:"dropdownBody"},c.a.createElement("button",{onClick:function(){return r(N.TYPES.PARAGRAPH)}},c.a.createElement(Y,null)," Texto"),c.a.createElement("button",{onClick:function(){return r(N.TYPES.CONTAINER)}},c.a.createElement(M,null)," Contenedor"),c.a.createElement("button",{onClick:function(){return r(N.TYPES.SHOP)}},c.a.createElement(V,null)," Tienda")))}n(71);function G(){return c.a.createElement(E.a,{icon:v.s,color:"#fcba03"})}function q(){return c.a.createElement(E.a,{icon:v.m,color:"#012452"})}function K(){return c.a.createElement(E.a,{icon:v.l,color:"#012452"})}function W(){return c.a.createElement(E.a,{icon:v.t,color:"#98a3b3"})}function Z(){return c.a.createElement(E.a,{icon:v.a,color:"#424242"})}function Q(){return c.a.createElement(E.a,{icon:v.e,color:"#424242"})}function X(e){var t=e.appContext,n=e.narrativeContextId,a=e.narrativeCategoryId,r=e.element,o=e.onMoveElementUp,i=void 0===o?function(e){}:o,u=e.onMoveElementDown,d=void 0===u?function(e){}:u,f=e.onDeleteElement,p=void 0===f?function(e){}:f,v=e.onRenameElement,E=void 0===v?function(e){}:v,h=e.onChildUpdate,g=void 0===h?function(){}:h,b=e.tabElement,y=void 0!==b&&b,k=Object(l.useState)(!1),C=Object(s.a)(k,2),j=C[0],O=C[1],x=Object(l.useState)(t.elementListItemExpandedStatuses[r.id]||!1),w=Object(s.a)(x,2),_=w[0],B=w[1],D=function(){return r.type===N.TYPES.CONTAINER},S=function(e){window.confirm("Estas seguro de eliminar el elemento ".concat(e.name))&&(r.removeElement(e.id),t.saveDB(),g())},I=function(e){r.moveElementUp(e.id),t.saveDB(),g()},T=function(e){r.moveElementDown(e.id),t.saveDB(),g()},P=function(e){var n=window.prompt("Ingresa el nuevo nombre del elemento",e.name);n&&(e.name=n,t.saveDB(),g())};return c.a.createElement("div",{className:y?"listItemTabbed":"",onMouseEnter:function(){O(!0)},onMouseLeave:function(){O(!1)}},c.a.createElement("div",{className:"flex "+(j?"highlightedListItem":"")},D()?c.a.createElement("button",{className:"collapseExpandButton",onClick:function(){return B(!_),void(t.elementListItemExpandedStatuses[r.id]=!_)}},_?c.a.createElement(Z,null):c.a.createElement(Q,null)):c.a.createElement(c.a.Fragment,null),c.a.createElement("div",{className:"flex2 elementListItemName "},c.a.createElement("span",{role:"img","aria-label":"icon"},function(){var e={};return e[N.TYPES.PARAGRAPH]=c.a.createElement(Y,null),e[N.TYPES.CONTAINER]=c.a.createElement(M,null),e[N.TYPES.SHOP]=c.a.createElement(V,null),e[r.type]}()," "),D()?c.a.createElement("span",null,r.name):c.a.createElement(m.b,{to:"/narrative-context/".concat(n,"/").concat(a,"/").concat(r.id)},r.name)),c.a.createElement("div",{className:"textRight"},D()?c.a.createElement(z,{onClick:function(e){var n=window.prompt("Ingresa el nombre del nuevo elemento");if(n){var a=A.createElement(n,e);r.addElement(a),t.saveDB(),g()}}}):c.a.createElement(c.a.Fragment,null),c.a.createElement("button",{onClick:function(){return E(r)}},c.a.createElement(G,null),c.a.createElement("span",{className:"tooltip"},"Renombrar")),c.a.createElement("button",{onClick:function(){return i(r)}},c.a.createElement(q,null),c.a.createElement("span",{className:"tooltip"},"Subir")),c.a.createElement("button",{onClick:function(){return d(r)}},c.a.createElement(K,null),c.a.createElement("span",{className:"tooltip"},"Bajar")),c.a.createElement("button",{onClick:function(){return p(r)}},c.a.createElement(W,null),c.a.createElement("span",{className:"tooltip"},"Eliminar")))),D()?c.a.createElement("div",null,_?r.elements.map((function(e){return c.a.createElement(X,{key:e.id,appContext:t,narrativeContextId:n,narrativeCategoryId:a,element:e,onMoveElementUp:I,onMoveElementDown:T,onDeleteElement:S,onRenameElement:P,onChildUpdate:g,tabElement:!0})})):c.a.createElement(c.a.Fragment,null)):c.a.createElement(c.a.Fragment,null))}function $(e){var t=e.appContext,n=e.narrativeContext,a=e.narrativeCategory,r=e.onCategoryChange,o=e.moveCategoryUp,i=e.moveCategoryDown,u=Object(l.useState)(a.elements),m=Object(s.a)(u,2),d=m[0],p=m[1],v=function(){p(Object(f.a)(a.elements)),setTimeout((function(){return p(a.elements)}),0)},E=function(e){window.confirm("Estas seguro de eliminar el elemento ".concat(e.name))&&(a.removeElement(e.id),t.saveDB(),v())},h=function(e){a.moveElementUp(e.id),t.saveDB(),v()},g=function(e){a.moveElementDown(e.id),t.saveDB(),v()},b=function(e){var n=window.prompt("Ingresa el nuevo nombre del elemento",e.name);n&&(e.name=n,t.saveDB(),r())};return c.a.createElement("div",{className:"NarrativeCategory"},c.a.createElement("div",{className:"flex"},c.a.createElement("h3",{className:"flex2"},a.name),c.a.createElement("div",{className:"textRight narrativeCategoryTitleButtons"},c.a.createElement(z,{onClick:function(e){var n=window.prompt("Ingresa el nombre del nuevo elemento");if(n){var r=A.createElement(n,e);a.addElement(r),t.saveDB(),v()}}}),c.a.createElement("button",{onClick:function(){var e=window.prompt("Ingresa el nuevo nombre de la categor\xeda",a.name);e&&(a.name=e,t.saveDB(),r())}},c.a.createElement(G,null),c.a.createElement("span",{className:"tooltip"},"Renombrar")),c.a.createElement("button",{onClick:function(){return o(a)}},c.a.createElement(q,null),c.a.createElement("span",{className:"tooltip"},"Subir")),c.a.createElement("button",{onClick:function(){return i(a)}},c.a.createElement(K,null),c.a.createElement("span",{className:"tooltip"},"Bajar")),c.a.createElement("button",{onClick:function(){window.confirm("Estas seguro de eliminar la categor\xeda ".concat(a.name))&&(n.removeNarrativeCategory(a.id),t.saveDB(),r())}},c.a.createElement(W,null),c.a.createElement("span",{className:"tooltip"},"Eliminar categor\xeda")))),c.a.createElement("div",{className:"narrativeCategoryElements"},d.map((function(e){return c.a.createElement(X,{key:e.id,appContext:t,narrativeContextId:n.id,narrativeCategoryId:a.id,element:e,onMoveElementUp:h,onMoveElementDown:g,onDeleteElement:E,onRenameElement:b,onChildUpdate:v})}))))}function ee(){return c.a.createElement(E.a,{icon:v.i,color:"#6942f5"})}function te(e){var t=e.appContext,n=Object(d.g)(),a=Object(d.h)().narrativeContextId,r=Object(l.useState)(null),o=Object(s.a)(r,2),i=o[0],u=o[1],m=Object(l.useState)([]),p=Object(s.a)(m,2),v=p[0],E=p[1];Object(l.useEffect)((function(){t.setNarrativeContextById(a);var e=t.getDB().getNarrativeContext(a);u(e),E(e.categories),t.setBackButtonUrl("/"),t.setForwardButtonUrl(null)}),[t,a]);var h=function(){E(Object(f.a)(i.categories))},g=function(e){i.moveNarrativeCategoryUp(e.id),t.saveDB(),E(Object(f.a)(i.categories))},b=function(e){i.moveNarrativeCategoryDown(e.id),t.saveDB(),E(Object(f.a)(i.categories))};return c.a.createElement("div",{className:"ViewNarrativeContext"},c.a.createElement("div",{className:"flex narrativeContextTitleBar"},c.a.createElement("h1",{className:"flex2"},"world"===(null===i||void 0===i?void 0:i.type)?c.a.createElement("span",{role:"img","aria-label":"world"},"\ud83c\udf0e"):c.a.createElement("span",{role:"img","aria-label":"books"},"\ud83d\udcda")," ",null===i||void 0===i?void 0:i.name),c.a.createElement("div",{className:"textRight narrativeContextTitleButtons"},c.a.createElement("button",{onClick:function(){var e=window.prompt("Ingresa nombre de la categor\xeda");if(e){var n=new P(e),r=t.getDB().getNarrativeContext(a);r.addNarrativeCategory(n),t.saveDB(),E(Object(f.a)(r.categories))}}},c.a.createElement(H,null),c.a.createElement("span",{className:"tooltip"},"Crear categor\xeda")),c.a.createElement("button",{onClick:function(){var e=window.prompt("Ingresa el nuevo nombre de ".concat("world"===i.type?"el mundo":"la campa\xf1a"),i.name);e&&(i.name=e,t.saveDB(),u(Object(L.a)({},i)),t.setNarrativeContextById(null),setTimeout((function(){u(i),t.setNarrativeContextById(a)}),0))}},c.a.createElement(G,null),c.a.createElement("span",{className:"tooltip"},"Renombrar")),c.a.createElement("a",{hidden:!0,id:"narrativeContextDownloadLink",href:"/"}," "),c.a.createElement("button",{onClick:function(){var e=document.getElementById("narrativeContextDownloadLink"),t=JSON.stringify(i.toJson(),null,2),n=new Blob([t],{type:"application/json"});e.href=URL.createObjectURL(n),e.download="".concat(R.TYPES.find((function(e){return e.type===i.type})).name," - ").concat(i.name,".json"),e.click()}},c.a.createElement(ee,null),c.a.createElement("span",{className:"tooltip"},"Exportar")),c.a.createElement("button",{onClick:function(){window.confirm("Estas seguro que deseas eliminar ".concat("world"===i.type?"el mundo":"la campa\xf1a"," ").concat(i.name))&&(t.getDB().removeNarrativeContext(a),t.saveDB(),n("/"))}},c.a.createElement(W,null),c.a.createElement("span",{className:"tooltip"},"Eliminar")))),v.map((function(e){return c.a.createElement($,{key:e.id,appContext:t,narrativeCategory:e,narrativeContext:i,onCategoryChange:h,moveCategoryUp:g,moveCategoryDown:b})})))}n(72),n(48);var ne=n(50),ae=n.n(ne);n(78);function re(e){var t=e.onChange,n=e.initialValue,a=Object(l.useRef)(),r=0,o=function(){var e;e=r+=1,setTimeout((function(){if(e===r){if(!a.current.getContents)return;t(a.current.getContents())}}),200)};return c.a.createElement("div",{className:"EditorContainer"},c.a.createElement(ae.a,{lang:"es",defaultValue:n,height:function(){var e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return e<=640?"48vh":e<=900?"67vh":"73vh"}(),onChange:function(e){return o()},onInput:function(e){return o()},getSunEditorInstance:function(e){a.current=e},setOptions:{buttonList:[["formatBlock","bold","underline","italic","strike"],["fontColor","hiliteColor"],["removeFormat"],["align","horizontalRule","list"],["table","link","image","video","audio"],["fullScreen","codeView"]],formats:[{tag:"p",name:"P\xe1rrafo"},{tag:"h1",name:"T\xedtulo"},{tag:"h2",name:"Subt\xedtulo"},{tag:"h3",name:"Secci\xf3n"},{tag:"h4",name:"Subsecci\xf3n"},{tag:"blockquote",name:"Bloque de descripci\xf3n"},{tag:"pre",name:"Notas de DM"}]}}))}var oe=n(52),le=-1!==window.location.origin.indexOf("localhost")?"http://localhost:5000/api":"https://narrativetools.herokuapp.com/api",ce=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,[{key:"_get_token",value:function(){return localStorage.getItem("token")}},{key:"_get",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var n,a,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={"Content-Type":"application/json"},(a=this._get_token())&&(n.Authorization=a),e.next=5,fetch("".concat(le).concat(t),{method:"GET",headers:n});case 5:if(!(o=e.sent).ok){e.next=10;break}return e.next=9,o.json();case 9:return e.abrupt("return",e.sent);case 10:return e.next=12,o.json();case 12:throw e.sent;case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_post",value:function(){var e=Object(o.a)(r.a.mark((function e(t,n){var a,o,l,c,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={"Content-Type":"application/json"},(o=this._get_token())&&(a.Authorization=o),l=JSON.stringify(n),c=null,"string"===typeof l&&l.length>1024?(a["Content-Encoding"]="gzip",c=oe.a.gzip(l)):(a["Content-Encoding"]=void 0,c=l),e.next=8,fetch("".concat(le).concat(t),{method:"POST",body:c,headers:a});case 8:if(!(i=e.sent).ok){e.next=13;break}return e.next=12,i.json();case 12:return e.abrupt("return",e.sent);case 13:return e.next=15,i.json();case 15:throw e.sent;case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_put",value:function(){var e=Object(o.a)(r.a.mark((function e(t,n){var a,o,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={"Content-Type":"application/json"},(o=this._get_token())&&(a.Authorization=o),e.next=5,fetch("".concat(le).concat(t),{method:"PUT",body:JSON.stringify(n),headers:a});case 5:if(!(l=e.sent).ok){e.next=10;break}return e.next=9,l.json();case 9:return e.abrupt("return",e.sent);case 10:return e.next=12,l.json();case 12:throw e.sent;case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_delete",value:function(){var e=Object(o.a)(r.a.mark((function e(t,n){var a,o,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={"Content-Type":"application/json"},(o=this._get_token())&&(a.Authorization=o),e.next=5,fetch("".concat(le).concat(t),{method:"DELETE",body:JSON.stringify(n),headers:a});case 5:if(!(l=e.sent).ok){e.next=10;break}return e.next=9,l.json();case 9:return e.abrupt("return",e.sent);case 10:return e.next=12,l.json();case 12:throw e.sent;case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),ie=function(e){Object(_.a)(n,e);var t=Object(B.a)(n);function n(){return Object(b.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"getCharacter",value:function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._get("/dnd_5e/characters/".concat(t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(ce);n(79);function ue(e){var t=e.character;return c.a.createElement("div",{className:"CharacterStatBlock"},c.a.createElement("h1",null,c.a.createElement("a",{href:"https://nivel20.com/games/dnd-5/characters/".concat(t.character_id)},t.name)),c.a.createElement("div",null,c.a.createElement("i",null,t.class," ",t.race,", ",t.alignment)),c.a.createElement("div",{className:"divider"}),c.a.createElement("div",null,c.a.createElement("b",null,"Clase de armadura "),c.a.createElement("span",null,t.armor_class)),c.a.createElement("div",null,c.a.createElement("b",null,"Puntos de golpe "),c.a.createElement("span",null,t.max_hp)),c.a.createElement("div",null,c.a.createElement("b",null,"Velocidad "),c.a.createElement("span",null,t.speed," pies")),c.a.createElement("div",null,c.a.createElement("b",null,"Bono de competencia "),c.a.createElement("span",null,"+",t.proficiency_bonus)),c.a.createElement("table",null,c.a.createElement("tbody",null,c.a.createElement("tr",null,t.ability_scores.map((function(e){return c.a.createElement("th",{key:"".concat(t.name,"_").concat(e.name,"_title")},c.a.createElement("b",null,e.name.toUpperCase().substring(0,3)))}))),c.a.createElement("tr",null,t.ability_scores.map((function(e){return c.a.createElement("td",{key:"".concat(t.name,"_").concat(e.name,"_score")},e.value," (",e.modifier>=0?"+":"",e.modifier,")")}))))),c.a.createElement("div",null,c.a.createElement("b",null,"Tiradas de salvaci\xf3n ")," ",c.a.createElement("span",null,t.saving_throws.filter((function(e){return e.has_proficiency})).map((function(e){return"".concat(e.name," ").concat(e.modifier>=0?"+":"").concat(e.modifier)})).join(", "))),c.a.createElement("div",null,c.a.createElement("b",null,"Habilidades con competencia ")," ",c.a.createElement("span",null,t.skills.filter((function(e){return e.has_proficiency})).map((function(e){return"".concat(e.name," ").concat(e.modifier>=0?"+":"").concat(e.modifier)})).join(", "))),c.a.createElement("div",null,c.a.createElement("b",null,"Sentidos ")," ",c.a.createElement("span",null,function(){var e=10+t.skills.find((function(e){return"Percepci\xf3n"===e.name})).modifier;return"Percepci\xf3n pasiva ".concat(e)}())),c.a.createElement("div",null,c.a.createElement("b",null,"Idiomas ")," ",c.a.createElement("span",null,t.languages)),null===t.spellcasting?c.a.createElement(c.a.Fragment,null):c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"divider"}),c.a.createElement("div",null,c.a.createElement("b",null,"Lanzamiento de conjuros "),"La habilidad de lanzamiento de conjuros de ",t.name," es ",t.spellcasting.spellcasting_ability," (CD de salvaci\xf3n de conjuros ",t.spellcasting.saving_throws_cd,", ",t.spellcasting.attack_bonus>=0?"+":"",t.spellcasting.attack_bonus," para golpear con ataques de conjuro). ",t.name," tiene acceso a los siguientes conjuros:",Object.keys(t.spellcasting.spell_levels).map((function(e){return parseInt(e)})).map((function(e){return 0===t.spellcasting.spell_levels[e].max_spell_slots?null:c.a.createElement("div",{key:"".concat(t.name,"_spell_level_").concat(e)},c.a.createElement("i",null,0===e?"Trucos (a voluntad)":"Nivel ".concat(e," (").concat(t.spellcasting.spell_levels[e].max_spell_slots," espacios): ")),t.spellcasting.spell_levels[e].spells.join(", "))})))))}var se=n(47),me=n.n(se);function de(e){var t=e.appContext,n=e.body,a=Object(l.useState)(),i=Object(s.a)(a,2),u=i[0],m=i[1],d=null;Object(l.useEffect)((function(){d=v(),m(d)}),[m,d]);var f=function(){var e=Object(o.a)(r.a.mark((function e(n){var a,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.getRepository(ie),e.next=3,a.getCharacter(n);case 3:o=e.sent,document.getElementById(n).innerHTML=me.a.renderToString(c.a.createElement(ue,{character:o}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p=function(e){var t,n=e.matchAll(/\[C\]\{([a-zA-Z0-9\-]+)\}/gm),a=e,r=Object(j.a)(n);try{var o=function(){var e,n=t.value;a=a.replace(n[0],(e=n[1],me.a.renderToString(c.a.createElement("div",{id:e})))),setTimeout((function(){return f(n[1])}),0)};for(r.s();!(t=r.n()).done;)o()}catch(l){r.e(l)}finally{r.f()}return a},v=function(){return p(n)};return c.a.createElement("div",{dangerouslySetInnerHTML:{__html:u}})}function fe(e){var t=e.appContext,n=e.element,a=e.parentExposedFuntions,r=Object(l.useState)(!1),o=Object(s.a)(r,2),i=o[0],u=o[1],m=null,d=!1,f=function(){m=null,u(!1)};return a.edit=function(){u(!0)},c.a.createElement("div",{className:"ParagraphElement"},i?c.a.createElement(c.a.Fragment,null,c.a.createElement("button",{onClick:function(){d?(n.body=m,t.saveDBAsync(),u(!1)):f()}},c.a.createElement("span",{role:"img","aria-label":"save"},"\ud83d\udcbe")," Guardar cambios"),c.a.createElement("button",{onClick:f},c.a.createElement("span",{role:"img","aria-label":"cancel"},"\u274c")," Descartar cambios")):c.a.createElement(c.a.Fragment,null),i?c.a.createElement(c.a.Fragment,null,c.a.createElement(re,{onChange:function(e){d=!0,m=e},initialValue:n.body})):c.a.createElement(de,{appContext:t,body:n.body}))}n(81);function pe(e){e.appContext;var t=e.items,n=e.onItemsChange,a=void 0===n?function(e){}:n,r=e.parentExposedFuntions,o=Object(l.useState)((null===t||void 0===t?void 0:t.map((function(e){return e.clone()})))||[]),i=Object(s.a)(o,2),u=i[0],m=i[1],d=function(e,t,n){e[t]=n,a(Object(f.a)(u)),m(Object(f.a)(u))};return r.addItem=function(){u.push(new I),a(Object(f.a)(u)),m(Object(f.a)(u))},c.a.createElement("div",{className:"ShopTableEditor"},c.a.createElement("table",{className:"shopTable"},c.a.createElement("tbody",null,c.a.createElement("tr",null,c.a.createElement("th",null,"Objeto"),c.a.createElement("th",null,"Enlace"),c.a.createElement("th",null,"Precio"),c.a.createElement("th",null,"Cantidad disponible"),c.a.createElement("th",null)),null===u||void 0===u?void 0:u.map((function(e){return c.a.createElement("tr",{key:e.id},c.a.createElement("td",null,c.a.createElement("input",{key:"".concat(e.id,"-titleInput"),onChange:function(t){return d(e,"title",t.target.value)},value:e.title||""})),c.a.createElement("td",null,c.a.createElement("input",{key:"".concat(e.id,"-linkInput"),onChange:function(t){return d(e,"link",t.target.value)},value:e.link||""})),c.a.createElement("td",null,c.a.createElement("input",{key:"".concat(e.id,"-priceInput"),onChange:function(t){return d(e,"price",t.target.value)},value:e.price||""})),c.a.createElement("td",null,c.a.createElement("input",{type:"number",key:"".concat(e.id,"-amountInput"),onChange:function(t){return d(e,"amount",parseInt(t.target.value))},value:e.amount||0})),c.a.createElement("td",null,c.a.createElement("button",{onClick:function(){return t=e,u.splice(u.indexOf(t),1),a(Object(f.a)(u)),void m(Object(f.a)(u));var t}},c.a.createElement("span",{role:"img","aria-label":"delete"},"\ud83d\uddd1\ufe0f"))))})))))}function ve(e){var t=e.appContext,n=e.element,a=e.parentExposedFuntions,r=Object(l.useState)(!1),o=Object(s.a)(r,2),i=o[0],u=o[1],m=null,d=!1,f={},p=function(){m=[],u(!1)};return a.edit=function(){u(!0)},c.a.createElement("div",{className:"ParagraphElement"},i?c.a.createElement(c.a.Fragment,null,c.a.createElement("button",{onClick:function(){f.addItem()}},c.a.createElement("span",{role:"img","aria-label":"plus"},"\u2795")," Agregar objeto"),c.a.createElement("button",{onClick:function(){d?(n.items=m,t.saveDBAsync(),u(!1)):p()}},c.a.createElement("span",{role:"img","aria-label":"save"},"\ud83d\udcbe")," Guardar cambios"),c.a.createElement("button",{onClick:p},c.a.createElement("span",{role:"img","aria-label":"cancel"},"\u274c")," Descartar cambios")):c.a.createElement(c.a.Fragment,null),c.a.createElement("br",null),i?c.a.createElement(c.a.Fragment,null,c.a.createElement(pe,{items:n.items,onItemsChange:function(e){d=!0,m=e},parentExposedFuntions:f})):c.a.createElement("table",{className:"shopTable"},c.a.createElement("tbody",null,c.a.createElement("tr",null,c.a.createElement("th",null,"Objeto"),c.a.createElement("th",null,"Precio"),c.a.createElement("th",null,"Cantidad disponible")),n.items.map((function(e){return c.a.createElement("tr",{key:e.id},c.a.createElement("td",null,e.link?c.a.createElement("a",{href:e.link},e.title):c.a.createElement("span",null,e.title)),c.a.createElement("td",null,e.price),c.a.createElement("td",null,e.amount))})))))}function Ee(){return c.a.createElement(E.a,{icon:v.h,color:"#574a6b"})}function he(){return c.a.createElement(E.a,{icon:v.n,color:"#424242"})}function ge(e){var t=e.appContext,n=Object(d.g)(),a=Object(d.h)(),r=a.narrativeContextId,o=a.narrativeCategoryId,i=a.elementId,u=Object(l.useState)(null),m=Object(s.a)(u,2),f=m[0],p=m[1],v={};Object(l.useEffect)((function(){t.setNarrativeContextById(r);var e=t.getDB().getNarrativeContext(r).getNarrativeCategory(o).findElementAnywhere(i);p(e),function(){var e=t.getDB().getNarrativeContext(r).getNarrativeCategory(o),n=e.getPrevElement(i,r),a=e.getNextElement(i,r);n?t.setBackButtonUrl("/narrative-context/".concat(r,"/").concat(o,"/").concat(n.id)):t.setBackButtonUrl("/narrative-context/".concat(r)),a?t.setForwardButtonUrl("/narrative-context/".concat(r,"/").concat(o,"/").concat(a.id)):t.setForwardButtonUrl(null)}()}),[t,r,o,i]);var E=function(){window.confirm("Estas seguro de eliminar el elemento ".concat(f.name))&&(t.getDB().getNarrativeContext(r).getNarrativeCategory(o).removeElement(f.id),t.saveDB(),n("/narrative-context/".concat(r)))};return c.a.createElement("div",{className:"ViewElement"},f?c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"flex viewElementTitleBar"},c.a.createElement("h2",{className:"flex2"},f.name),c.a.createElement("div",{className:"textRight viewElementTitleButtons"},c.a.createElement("button",{onClick:function(){var e=window.prompt("Ingresa el nuevo nombre del elemento",f.name);if(e){var n=t.getDB().getNarrativeContext(r).getNarrativeCategory(o).findElementAnywhere(i);n.name=e,t.saveDB(),p(Object(L.a)({},n)),setTimeout((function(){p(n)}),0)}}},c.a.createElement(G,null),c.a.createElement("span",{className:"tooltip"},"Renombrar")),c.a.createElement("button",{onClick:function(){v.edit()}},c.a.createElement(Ee,null),c.a.createElement("span",{className:"tooltip"},"Editar")),c.a.createElement("button",{onClick:function(){var e="".concat(window.location.origin,"/narrative-context/").concat(r,"/").concat(o,"/").concat(i);navigator.clipboard.writeText(e)}},c.a.createElement(he,null),c.a.createElement("span",{className:"tooltip"},"Copiar enlace")))),{paragraph:c.a.createElement(fe,{key:f.id,appContext:t,element:f,onDelete:E,parentExposedFuntions:v}),shop:c.a.createElement(ve,{key:f.id,appContext:t,element:f,onDelete:E,parentExposedFuntions:v})}[f.type]):c.a.createElement(c.a.Fragment,null))}n(82),n(83);var be=function(e){Object(_.a)(n,e);var t=Object(B.a)(n);function n(){var e;Object(b.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).onLogin=function(){},e.onLogout=function(){},e}return Object(y.a)(n,[{key:"login",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._post("/auth/login",t);case 2:n=e.sent,localStorage.setItem("token",n.token),localStorage.setItem("tokenUsername",t.username),this.onLogin();case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isAuthenticated",value:function(){return!!localStorage.getItem("token")}},{key:"getAuthenticatedUsername",value:function(){return localStorage.getItem("tokenUsername")}},{key:"logout",value:function(){localStorage.removeItem("token"),localStorage.removeItem("tokenUsername"),this.onLogout()}}]),n}(ce);function ye(){return c.a.createElement(E.a,{icon:v.u})}function ke(){return c.a.createElement(E.a,{icon:v.r,color:"#424242"})}function Ce(e){var t=e.appContext,n=Object(l.useRef)();return c.a.createElement("div",{className:"SessionMenuButton"},c.a.createElement("button",{className:"sessionIconButton",onClick:function(){n.current.classList.toggle("showDropdownBody")}},c.a.createElement(ye,null)),c.a.createElement("div",{ref:n,className:"dropdownBody"},c.a.createElement("button",{onClick:function(){t.getRepository(be).logout()}},c.a.createElement(ke,null)," Cerrar sesi\xf3n")))}function je(e){var t=e.appContext,n=Object(l.useState)("/"),a=Object(s.a)(n,2),r=a[0],o=a[1],i=Object(l.useState)("/"),u=Object(s.a)(i,2),d=u[0],f=u[1],p=Object(l.useState)(null),h=Object(s.a)(p,2),g=h[0],b=h[1];return t.setBackButtonUrl=o,t.setForwardButtonUrl=f,t.setNarrativeContextById=function(e){var n=null;e&&(n=t.getDB().getNarrativeContext(e)),b(n)},c.a.createElement("div",{className:"Navbar"},c.a.createElement("div",{className:"navbarContent"},c.a.createElement("div",{className:"flex1"},c.a.createElement(m.b,{to:"/",id:"homeTitleLink"},c.a.createElement(E.a,{icon:v.g})," Inicio")),c.a.createElement("div",{className:"textCenter"},g?c.a.createElement(m.b,{to:"/narrative-context/".concat(g.id),id:"narrativeContextTitleLink"},g.name):c.a.createElement(c.a.Fragment,null)),c.a.createElement("div",{className:"flex2 textRight",id:"nabvarNavigationIcons"},c.a.createElement("span",{className:"iconButton ".concat(r?"iconButtonActive":"iconButtonInactive")},r?c.a.createElement(m.b,{to:r},c.a.createElement(E.a,{icon:v.b})):c.a.createElement(E.a,{icon:v.b,className:"inactiveLink"})),c.a.createElement("span",null," "),c.a.createElement("span",{className:"iconButton ".concat(d?"iconButtonActive":"iconButtonInactive")},d?c.a.createElement(m.b,{to:d},c.a.createElement(E.a,{icon:v.c})):c.a.createElement(E.a,{icon:v.c,className:"inactiveLink"})),t.getRepository(be).isAuthenticated()?c.a.createElement(Ce,{appContext:t}):c.a.createElement(c.a.Fragment,null))))}n(84);function Oe(e){var t=e.appContext,n=Object(l.useState)(null),a=Object(s.a)(n,2),i=a[0],u=a[1],m=Object(l.useState)(null),d=Object(s.a)(m,2),f=d[0],p=d[1];Object(l.useEffect)((function(){t.setBackButtonUrl(null),t.setForwardButtonUrl(null)}),[t]);var v=function(){var e=Object(o.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.getRepository(be).login({username:i,password:f});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),alert("Usuario o contrese\xf1a inv\xe1lidos!");case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(){return e.apply(this,arguments)}}();return c.a.createElement("form",{className:"LoginView",onSubmit:function(e){return e.preventDefault()}},c.a.createElement("input",{type:"text",name:"username",onChange:function(e){return u(e.target.value)},placeholder:"Usuario"}),c.a.createElement("input",{type:"password",name:"password",onChange:function(e){return p(e.target.value)},placeholder:"Contrase\xf1a"}),c.a.createElement("button",{type:"submit",onClick:v},"Iniciar sesi\xf3n"))}function xe(e){var t=e.appContext;return Object(l.useEffect)((function(){t.setBackButtonUrl(null),t.setForwardButtonUrl(null),t.getRepository(be).logout()}),[t]),c.a.createElement(c.a.Fragment,null)}n(85);function we(){return c.a.createElement("div",{className:"UpdatingDBIndicator"},c.a.createElement(E.a,{className:"updatingDBIcon",icon:v.f}))}function _e(e){var t=e.appContext,n=t.getRepository(be),a=Object(l.useState)(n.isAuthenticated()),r=Object(s.a)(a,1)[0],o=Object(l.useState)(!1),i=Object(s.a)(o,2),u=i[0],f=i[1];return t.setUpdatingDBIndicator=f,c.a.createElement("div",{className:"App"},u?c.a.createElement(we,null):c.a.createElement(c.a.Fragment,null),c.a.createElement(m.a,null,c.a.createElement(je,{appContext:t}),c.a.createElement("div",{className:"RouterContainer"},c.a.createElement(d.d,null,r?c.a.createElement(c.a.Fragment,null,c.a.createElement(d.b,{path:"/create-narrative-context",element:c.a.createElement(F,{appContext:t})}),c.a.createElement(d.b,{path:"/narrative-context/:narrativeContextId/:narrativeCategoryId/:elementId",element:c.a.createElement(ge,{appContext:t})}),c.a.createElement(d.b,{path:"/narrative-context/:narrativeContextId",element:c.a.createElement(te,{appContext:t})}),c.a.createElement(d.b,{path:"/logout",element:c.a.createElement(xe,{appContext:t})}),c.a.createElement(d.b,{path:"/",element:c.a.createElement(J,{appContext:t})}),c.a.createElement(d.b,{path:"*",element:c.a.createElement(d.a,{to:"/"})})):c.a.createElement(c.a.Fragment,null,c.a.createElement(d.b,{path:"/login",element:c.a.createElement(Oe,{appContext:t})}),c.a.createElement(d.b,{path:"*",element:c.a.createElement(d.a,{to:"/login"})}),c.a.createElement(d.b,{path:"/",element:c.a.createElement(d.a,{to:"/login"})}))))))}var Be=function(){function e(){Object(b.a)(this,e),this.campaigns=null,this.worlds=null,this.campaigns=[],this.worlds=[]}return Object(y.a)(e,[{key:"getNarrativeContext",value:function(e){return this.campaigns.concat(this.worlds).find((function(t){return t.id===e}))}},{key:"addNarrativeContext",value:function(e){"world"===e.type?this.addWorld(e):this.addCampaign(e)}},{key:"removeNarrativeContext",value:function(e){var t=this.getNarrativeContext(e),n=null;(n="world"===t.type?this.worlds:this.campaigns).splice(n.indexOf(t),1)}},{key:"addWorld",value:function(e){this.worlds.push(e)}},{key:"addCampaign",value:function(e){this.campaigns.push(e)}},{key:"toJson",value:function(){return{campaigns:this.campaigns.map((function(e){return e.toJson()})),worlds:this.worlds.map((function(e){return e.toJson()}))}}}],[{key:"fromJson",value:function(t){var n=new e;return n.campaigns=t.campaigns.map((function(e){return R.fromJson(e)})),n.worlds=t.worlds.map((function(e){return R.fromJson(e)})),n}}]),e}(),Ne=function(e){Object(_.a)(n,e);var t=Object(B.a)(n);function n(){return Object(b.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"pullDB",value:function(){var e=Object(o.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._get("/database");case 2:if(t=e.sent,0!==Object.keys(t).length){e.next=5;break}return e.abrupt("return",null);case 5:return e.abrupt("return",Be.fromJson(t));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"pushDB",value:function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._post("/database",t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(ce),De=function(){function e(){Object(b.a)(this,e),e._db=new Be}return Object(y.a)(e,[{key:"tryGetCloudDB",value:function(){var t=Object(o.a)(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._tryDownloadCloudDB();case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"registerOnCloudDBDownloadedHook",value:function(t){e._onCloudDBDownloadedHooks.push(t)}},{key:"registerAfterSaveHook",value:function(t){e._afterSaveHooks.push(t)}},{key:"registerOnDirtyDBCallback",value:function(t){e._onDirtyDBCallback=t}},{key:"enableSavingPrevention",value:function(){e._preventSave=!0}},{key:"save",value:function(){e._save()}}],[{key:"_tryDownloadCloudDB",value:function(){var t=Object(o.a)(r.a.mark((function t(){var n,a,o;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Downloading remote DB"),t.next=3,e._dbSyncRepository.pullDB();case 3:if(n=t.sent){e._db=n,a=Object(j.a)(e._onCloudDBDownloadedHooks);try{for(a.s();!(o=a.n()).done;)(0,o.value)()}catch(r){a.e(r)}finally{a.f()}}case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"_save",value:function(){var t=Object(o.a)(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._preventSave){t.next=3;break}return e._onDirtyDBCallback(),t.abrupt("return");case 3:return e.setUpdatingDBIndicator(!0),t.next=6,e._dbSyncRepository.pushDB(e._db.toJson());case 6:e._callAfterSaveHooks(),e.setUpdatingDBIndicator(!1);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"_callAfterSaveHooks",value:function(){var t,n=Object(j.a)(e._afterSaveHooks);try{for(n.s();!(t=n.n()).done;){(0,t.value)()}}catch(a){n.e(a)}finally{n.f()}}}]),e}();De._DB_KEY="db",De._db=null,De._afterSaveHooks=[],De._preventSave=!1,De._onDirtyDBCallback=function(){},De._dbSyncRepository=new Ne,De._onCloudDBDownloadedHooks=[],De.setUpdatingDBIndicator=function(e){};var Se=function(){function e(){Object(b.a)(this,e),this._repositories=null,this.setUpdatingDBIndicator=function(e){},this.elementListItemExpandedStatuses={},this._repositories={}}return Object(y.a)(e,[{key:"getRepository",value:function(e){return this._repositories[e]||(this._repositories[e]=new e),this._repositories[e]}},{key:"setBackButtonUrl",value:function(e){}},{key:"setForwardButtonUrl",value:function(e){}},{key:"setNarrativeContextById",value:function(e){}},{key:"getDB",value:function(){return De._db}},{key:"saveDBAsync",value:function(){var e=this;setTimeout((function(){return e.saveDB()}),0)}},{key:"saveDB",value:function(){var e=Object(o.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return De.setUpdatingDBIndicator=this.setUpdatingDBIndicator,e.prev=1,e.next=4,De._save();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),alert("Ha ocurrido un error al tratar de enviar los cambios al servidor de la aplicaci\xf3n!");case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(){return e.apply(this,arguments)}}()}]),e}(),Ie=function(){function e(t){Object(b.a)(this,e),this._appContext=null,this._interval=null,this._INTERVAL_TIME=2e3,this._lastDBSaveTime=null,this._LAST_SAVE_DATE_KEY="last_save_date",this._appContext=t,this._lastDBSaveTime=this._getStoredDate(),this._registerAfterSaveHook(),this._registerOnDirtyDBCallback()}return Object(y.a)(e,[{key:"_registerAfterSaveHook",value:function(){var e=this;this._appContext.getRepository(De).registerAfterSaveHook((function(){e._updateLastSaveInfo()}))}},{key:"_registerOnDirtyDBCallback",value:function(){var e=this;this._appContext.getRepository(De).registerOnDirtyDBCallback((function(){e._onDirtyDB()}))}},{key:"_updateLastSaveInfo",value:function(){var e=new Date;this._lastDBSaveTime=e,localStorage.setItem(this._LAST_SAVE_DATE_KEY,e.toString())}},{key:"_getStoredDate",value:function(){var e=localStorage.getItem(this._LAST_SAVE_DATE_KEY);return e?new Date(e):null}},{key:"_isWorkingDirty",value:function(){var e=this._getStoredDate();return e&&!this._lastDBSaveTime||e&&this._lastDBSaveTime&&this._lastDBSaveTime<e}},{key:"start",value:function(){var e=this;this._interval=setInterval((function(){e._isWorkingDirty()&&(e._appContext.getRepository(De).enableSavingPrevention(),clearInterval(e._interval),e._onDirtyDB())}),this._INTERVAL_TIME)}},{key:"_onDirtyDB",value:function(){window.confirm("Usted esta trabajando con una version desactualizada de la base de datos local y no podra guardar cambios en esta. Por favor recargue la aplicaci\xf3n para poder volver a utilizarla con normalidad o haga click en aceptar / ok para hacerlo autom\xe1ticamente.")&&window.location.reload()}}]),e}(),Te=new Se,Ae=new Ie(Te),Pe=Te.getRepository(De),Re=Te.getRepository(be),Ue=function(){var e=Object(o.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!Re.isAuthenticated()){e.next=4;break}return e.next=4,Pe.tryGetCloudDB();case 4:Ae.start(),u.a.render(c.a.createElement(_e,{appContext:Te}),document.getElementById("root")),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),alert("Ha ocurrido un error al sincronizar con el servidor, por favor refresca la p\xe1gina!");case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();Re.onLogin=function(){window.location="/"},Re.onLogout=function(){window.location="/login"},Ue()}},[[53,1,2]]]);
//# sourceMappingURL=main.d9cf3dde.chunk.js.map