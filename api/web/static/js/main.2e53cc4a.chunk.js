(this["webpackJsonpreact-dnd"]=this["webpackJsonpreact-dnd"]||[]).push([[0],{47:function(e,t,n){},52:function(e,t,n){e.exports=n(83)},54:function(e,t,n){},59:function(e,t,n){},60:function(e,t,n){},61:function(e,t,n){},67:function(e,t,n){},68:function(e,t,n){},69:function(e,t,n){},70:function(e,t,n){},71:function(e,t,n){},74:function(e,t,n){var a={"./ckb.js":25,"./da.js":26,"./de.js":27,"./en.js":18,"./es.js":28,"./fr.js":29,"./he.js":30,"./index.js":75,"./it.js":31,"./ja.js":32,"./ko.js":33,"./lv.js":34,"./nl.js":35,"./pl.js":36,"./pt_br.js":37,"./ro.js":38,"./ru.js":39,"./se.js":40,"./ua.js":41,"./zh_cn.js":42};function r(e){var t=o(e);return n(t)}function o(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}r.keys=function(){return Object.keys(a)},r.resolve=o,e.exports=r,r.id=74},77:function(e,t,n){},78:function(e,t,n){},79:function(e,t,n){},80:function(e,t,n){},81:function(e,t,n){},82:function(e,t,n){},83:function(e,t,n){"use strict";n.r(t);var a=n(5),r=n.n(a),o=n(9),i=(n(54),n(0)),l=n.n(i),c=n(48),u=n.n(c),s=n(4),m=(n(59),n(60),n(11)),f=n(3),d=n(10),v=(n(61),[{name:"5e Tools",url:"https://5e.tools/"},{name:"Bestiario (5e Tools)",url:"https://5e.tools/bestiary.html"},{name:"Objetos mundanos y m\xe1gicos (5e Tools)",url:"https://5e.tools/items.html"},{name:"Calculadora de encuentros",url:"https://kastark.co.uk/rpgs/encounter-calculator-5th/"},{name:"Tabla de encuentros aleatorios (5e Tools)",url:"https://5e.tools/encountergen.html"},{name:"Generador de nombres",url:"https://www.fantasynamegen.com/"},{name:"Razas",url:"https://www.dndbeyond.com/races"},{name:"Clases",url:"https://www.dndbeyond.com/classes"}]),p=n(2),E=n(1);function h(){return l.a.createElement(E.a,{icon:p.d,color:"#72b52f"})}function g(){return l.a.createElement(E.a,{icon:p.j,color:"#6942f5"})}var b=n(6),y=n(7),k=n(87),C=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,null,[{key:"generateId",value:function(){return Object(k.a)()}}]),e}(),j=n(14),O=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,null,[{key:"moveElementInArray",value:function(e,t,n){if(n>=e.length)for(var a=n-e.length+1;a--;)e.push(void 0);e.splice(n,0,e.splice(t,1)[0])}}]),e}(),x=n(22),w=n(13),B=n(17),N=n(16),D=function(){function e(t,n){Object(b.a)(this,e),this.id=null,this.name=null,this.type=null,this.id=C.generateId(),this.name=t,this.type=n}return Object(y.a)(e,[{key:"toJson",value:function(){return{id:this.id,name:this.name,type:this.type}}}],[{key:"fromJson",value:function(e){throw Error("This method should not be used!")}}]),e}();D.TYPES={PARAGRAPH:"paragraph",CONTAINER:"container",SHOP:"shop"};var _=function(e){Object(B.a)(n,e);var t=Object(N.a)(n);function n(e){var a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Object(b.a)(this,n),(a=t.call(this,e,D.TYPES.PARAGRAPH)).body=null,a.body=r,a}return Object(y.a)(n,[{key:"toJson",value:function(){var e=Object(x.a)(Object(w.a)(n.prototype),"toJson",this).call(this);return e.body=this.body,e}}],[{key:"fromJson",value:function(e){return new n(e.name,e.body)}}]),n}(D),I=function(e){Object(B.a)(n,e);var t=Object(N.a)(n);function n(e){var a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(b.a)(this,n),(a=t.call(this,e,D.TYPES.CONTAINER)).elements=null,a.elements=r,a}return Object(y.a)(n,[{key:"getElement",value:function(e){return this.elements.find((function(t){return t.id===e}))}},{key:"addElement",value:function(e){this.elements.push(e)}},{key:"removeElement",value:function(e){var t=this.getElement(e);this.elements.splice(this.elements.indexOf(t),1)}},{key:"moveElementUp",value:function(e){var t=this.elements.indexOf(this.elements.find((function(t){return t.id===e}))),n=t-1;0!==t&&O.moveElementInArray(this.elements,t,n)}},{key:"moveElementDown",value:function(e){var t=this.elements.indexOf(this.elements.find((function(t){return t.id===e}))),n=t+1;n!==this.elements.length&&O.moveElementInArray(this.elements,t,n)}},{key:"findInChild",value:function(e){var t,n=Object(j.a)(this.elements);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a.id===e)return a;if(a.findInChild){var r=a.findInChild(e);if(r)return r}}}catch(o){n.e(o)}finally{n.f()}return null}},{key:"getPlainViewableElements",value:function(){var e,t=[],n=Object(j.a)(this.elements);try{for(n.s();!(e=n.n()).done;){var a=e.value;a.type===D.TYPES.CONTAINER?t=t.concat(a.getPlainViewableElements()):t.push(a)}}catch(r){n.e(r)}finally{n.f()}return t}},{key:"toJson",value:function(){var e=Object(x.a)(Object(w.a)(n.prototype),"toJson",this).call(this);return e.elements=this.elements.map((function(e){return e.toJson()})),e}}],[{key:"fromJson",value:function(e){return new n(e.name,(e.elements||[]).map((function(e){return A.mapElementFromJson(e)})))}}]),n}(D),S=function(){function e(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(b.a)(this,e),this.id=null,this.title=null,this.price=null,this.link=null,this.amount=0,this.id=C.generateId(),this.title=t,this.price=n,this.link=a,this.amount=r}return Object(y.a)(e,[{key:"clone",value:function(){return e.fromJson(this.toJson())}},{key:"toJson",value:function(){return{id:this.id,title:this.title,price:this.price,link:this.link,amount:this.amount}}}],[{key:"fromJson",value:function(t){var n=new e(t.title,t.price,t.link,t.amount);return n.id=t.id,n}}]),e}(),T=function(e){Object(B.a)(n,e);var t=Object(N.a)(n);function n(e){var a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(b.a)(this,n),(a=t.call(this,e,D.TYPES.SHOP)).items=null,a.items=r,a}return Object(y.a)(n,[{key:"toJson",value:function(){var e=Object(x.a)(Object(w.a)(n.prototype),"toJson",this).call(this);return e.items=this.items.map((function(e){return e.toJson()})),e}}],[{key:"fromJson",value:function(e){return new n(e.name,e.items.map((function(e){return S.fromJson(e)})))}}]),n}(D),A=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,null,[{key:"mapElementFromJson",value:function(e){var t=this._ELEMENT_TYPES_MAPPING[e.type].fromJson(e);return t.id=e.id,t}},{key:"createElement",value:function(e,t){return new this._ELEMENT_TYPES_MAPPING[t](e)}}]),e}();A._ELEMENT_TYPES_MAPPING={paragraph:_,container:I,shop:T};var P=function(){function e(t){Object(b.a)(this,e),this.id=null,this.type=null,this.elements=null,this.id=C.generateId(),this.name=t,this.elements=[]}return Object(y.a)(e,[{key:"getElement",value:function(e){return this.elements.find((function(t){return t.id===e}))}},{key:"findElementAnywhere",value:function(e){var t,n=Object(j.a)(this.elements);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a.id===e)return a;if(a.findInChild){var r=a.findInChild(e);if(r)return r}}}catch(o){n.e(o)}finally{n.f()}return null}},{key:"addElement",value:function(e){this.elements.push(e)}},{key:"removeElement",value:function(e){var t=this.getElement(e);this.elements.splice(this.elements.indexOf(t),1)}},{key:"moveElementUp",value:function(e){var t=this.elements.indexOf(this.elements.find((function(t){return t.id===e}))),n=t-1;0!==t&&O.moveElementInArray(this.elements,t,n)}},{key:"moveElementDown",value:function(e){var t=this.elements.indexOf(this.elements.find((function(t){return t.id===e}))),n=t+1;n!==this.elements.length&&O.moveElementInArray(this.elements,t,n)}},{key:"_getPlainViewableElements",value:function(){var e,t=[],n=Object(j.a)(this.elements);try{for(n.s();!(e=n.n()).done;){var a=e.value;a.type===D.TYPES.CONTAINER?t=t.concat(a.getPlainViewableElements()):t.push(a)}}catch(r){n.e(r)}finally{n.f()}return t}},{key:"getPrevElement",value:function(e){var t=this._getPlainViewableElements(),n=t.indexOf(t.find((function(t){return t.id===e})));return 0===n?null:t[n-1]}},{key:"getNextElement",value:function(e){var t=this._getPlainViewableElements(),n=t.indexOf(t.find((function(t){return t.id===e})));return n===t.length-1?null:t[n+1]}},{key:"toJson",value:function(){return{id:this.id,name:this.name,elements:this.elements.map((function(e){return e.toJson()}))}}}],[{key:"fromJson",value:function(t){var n=new e(t.name);return n.id=t.id,n.elements=t.elements.map((function(e){return A.mapElementFromJson(e)})),n}}]),e}(),R=function(){function e(t,n){if(Object(b.a)(this,e),this.id=null,this.type=null,this.name=null,this.categories=null,!e.TYPES.find((function(e){return e.type===t})))throw Error("Invalid type");this.id=C.generateId(),this.type=t,this.name=n,this.categories=[]}return Object(y.a)(e,[{key:"getNarrativeCategory",value:function(e){return this.categories.find((function(t){return t.id===e}))}},{key:"addNarrativeCategory",value:function(e){this.categories.push(e)}},{key:"removeNarrativeCategory",value:function(e){var t=this.getNarrativeCategory(e);this.categories.splice(this.categories.indexOf(t),1)}},{key:"moveNarrativeCategoryUp",value:function(e){var t=this.categories.indexOf(this.categories.find((function(t){return t.id===e}))),n=t-1;0!==t&&O.moveElementInArray(this.categories,t,n)}},{key:"moveNarrativeCategoryDown",value:function(e){var t=this.categories.indexOf(this.categories.find((function(t){return t.id===e}))),n=t+1;n!==this.categories.length&&O.moveElementInArray(this.categories,t,n)}},{key:"toJson",value:function(){return{id:this.id,type:this.type,name:this.name,categories:this.categories.map((function(e){return e.toJson()}))}}}],[{key:"fromJson",value:function(t){var n=new e(t.type,t.name);return n.id=t.id,n.categories=t.categories.map((function(e){return P.fromJson(e)})),n}}]),e}();R.TYPES=[{type:"world",name:"Mundo"},{type:"campaign",name:"Campa\xf1a"}];var U=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,null,[{key:"importFromJson",value:function(e,t){var n=null;try{n=R.fromJson(JSON.parse(e))}catch(a){return void alert("Ha ocurrido un error al importar el contexto narrativo. El formato del archivo no parece ser v\xe1lido!")}t.getDB().getNarrativeContext(n.id)?alert("Ha ocurrido un error al importar el contexto narrativo. Parece ser que posees otro contexto narrativo con el mismo identificador!"):(t.getDB().addNarrativeContext(n),alert("La importaci\xf3n fue realizada con \xe9xito!"),t.saveDB())}}]),e}();function J(e){var t=e.appContext,n=Object(f.g)(),a=Object(i.useState)([]),c=Object(s.a)(a,2),u=c[0],p=c[1],E=Object(i.useState)([]),b=Object(s.a)(E,2),y=b[0],k=b[1];Object(i.useEffect)((function(){t.setNarrativeContextById(null),t.setBackButtonUrl(null),t.setForwardButtonUrl(null);var e=t.getDB();p(e.campaigns),k(e.worlds)}),[t]);var C=function(){var e=Object(o.a)(r.a.mark((function e(n){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.preventDefault(),(a=new FileReader).onload=function(){var e=Object(o.a)(r.a.mark((function e(n){var a,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n.target.result,U.importFromJson(a,t),o=t.getDB(),p(Object(d.a)(o.campaigns)),k(Object(d.a)(o.worlds)),setTimeout((function(){p(o.campaigns),k(o.worlds)}),0),document.getElementById("narrativeContextFileSelector").value=null;case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.readAsText(n.target.files[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return l.a.createElement("div",null,l.a.createElement("div",{className:"homeTitleSection"},l.a.createElement("h1",{className:"flex1"},"Contextos narrativos"),l.a.createElement("div",{className:"homeTitleButtons"},l.a.createElement("button",{onClick:function(){n("/create-narrative-context")}},l.a.createElement(h,null)," Crear"),l.a.createElement("input",{type:"file",id:"narrativeContextFileSelector",hidden:!0,onChange:C,accept:"application/json"}),l.a.createElement("button",{onClick:function(){return document.getElementById("narrativeContextFileSelector").click()}},l.a.createElement(g,null)," Importar"))),l.a.createElement("h2",null,l.a.createElement("span",{role:"img","aria-label":"books"},"\ud83d\udcda")," Campa\xf1as"),l.a.createElement("ul",null,u.map((function(e){return l.a.createElement("li",{key:e.id},l.a.createElement(m.b,{to:"/narrative-context/".concat(e.id)},e.name))}))),l.a.createElement("h2",null,l.a.createElement("span",{role:"img","aria-label":"world"},"\ud83c\udf0e")," Mundos"),l.a.createElement("ul",null,y.map((function(e){return l.a.createElement("li",{key:e.id},l.a.createElement(m.b,{to:"/narrative-context/".concat(e.id)},e.name))}))),l.a.createElement("h2",null,l.a.createElement("span",{role:"img","aria-label":"tools"},"\u2692\ufe0f")," Herramientas"),l.a.createElement("ul",null,v.map((function(e){return l.a.createElement("li",{key:e.name},l.a.createElement("a",{href:e.url},e.name))}))))}function F(e){var t=e.appContext,n=Object(f.g)(),a=Object(i.useState)(),r=Object(s.a)(a,2),o=r[0],c=r[1],u=Object(i.useState)(R.TYPES[0].type),m=Object(s.a)(u,2),d=m[0],v=m[1];Object(i.useEffect)((function(){t.setNarrativeContextById(null)}),[t]);return l.a.createElement("div",null,l.a.createElement("h1",null,"Crear contexto narrativo"),l.a.createElement("input",{type:"text",placeholder:"Nombre",onChange:function(e){return c(e.target.value)}}),l.a.createElement("select",{onChange:function(e){return v(e.target.value)}},R.TYPES.map((function(e){return l.a.createElement("option",{key:e.type,value:e.type},e.name)}))),l.a.createElement("button",{onClick:function(){var e=new R(d,o);t.getDB().addNarrativeContext(e),t.saveDB(),n("/")}},"Crear"))}var L=n(44);n(67),n(68),n(69);function H(){return l.a.createElement(E.a,{icon:p.o,color:"#2b3340"})}function Y(){return l.a.createElement(E.a,{icon:p.p,color:"#baa28f"})}function M(){return l.a.createElement(E.a,{icon:p.k,color:"#FACC30"})}function V(){return l.a.createElement(E.a,{icon:p.q,color:"#609fbf"})}function z(e){var t=e.onClick,n=void 0===t?function(e){}:t,a=Object(i.useRef)(),r=function(e){a.current.classList.toggle("showDropdownBody"),n(e)};return l.a.createElement("div",{className:"CreateElementButton"},l.a.createElement("button",{onClick:function(){a.current.classList.toggle("showDropdownBody")}},l.a.createElement(H,null),l.a.createElement("span",{className:"tooltip"},"Crear elemento")),l.a.createElement("div",{ref:a,className:"dropdownBody"},l.a.createElement("button",{onClick:function(){return r(D.TYPES.PARAGRAPH)}},l.a.createElement(Y,null)," Texto"),l.a.createElement("button",{onClick:function(){return r(D.TYPES.CONTAINER)}},l.a.createElement(M,null)," Contenedor"),l.a.createElement("button",{onClick:function(){return r(D.TYPES.SHOP)}},l.a.createElement(V,null)," Tienda")))}n(70);function G(){return l.a.createElement(E.a,{icon:p.s,color:"#fcba03"})}function q(){return l.a.createElement(E.a,{icon:p.m,color:"#012452"})}function K(){return l.a.createElement(E.a,{icon:p.l,color:"#012452"})}function W(){return l.a.createElement(E.a,{icon:p.t,color:"#98a3b3"})}function Q(){return l.a.createElement(E.a,{icon:p.a,color:"#424242"})}function X(){return l.a.createElement(E.a,{icon:p.e,color:"#424242"})}function Z(e){var t=e.appContext,n=e.narrativeContextId,a=e.narrativeCategoryId,r=e.element,o=e.onMoveElementUp,c=void 0===o?function(e){}:o,u=e.onMoveElementDown,f=void 0===u?function(e){}:u,d=e.onDeleteElement,v=void 0===d?function(e){}:d,p=e.onRenameElement,E=void 0===p?function(e){}:p,h=e.onChildUpdate,g=void 0===h?function(){}:h,b=e.tabElement,y=void 0!==b&&b,k=Object(i.useState)(!1),C=Object(s.a)(k,2),j=C[0],O=C[1],x=Object(i.useState)(!1),w=Object(s.a)(x,2),B=w[0],N=w[1],_=function(){return r.type===D.TYPES.CONTAINER},I=function(e){window.confirm("Estas seguro de eliminar el elemento ".concat(e.name))&&(r.removeElement(e.id),t.saveDB(),g())},S=function(e){r.moveElementUp(e.id),t.saveDB(),g()},T=function(e){r.moveElementDown(e.id),t.saveDB(),g()},P=function(e){var n=window.prompt("Ingresa el nuevo nombre del elemento",e.name);n&&(e.name=n,t.saveDB(),g())};return l.a.createElement("div",{className:y?"listItemTabbed":"",onMouseEnter:function(){O(!0)},onMouseLeave:function(){O(!1)}},l.a.createElement("div",{className:"flex "+(j?"highlightedListItem":"")},_()?l.a.createElement("button",{className:"collapseExpandButton",onClick:function(){N(!B)}},B?l.a.createElement(Q,null):l.a.createElement(X,null)):l.a.createElement(l.a.Fragment,null),l.a.createElement("div",{className:"flex2 elementListItemName "},l.a.createElement("span",{role:"img","aria-label":"icon"},function(){var e={};return e[D.TYPES.PARAGRAPH]=l.a.createElement(Y,null),e[D.TYPES.CONTAINER]=l.a.createElement(M,null),e[D.TYPES.SHOP]=l.a.createElement(V,null),e[r.type]}()," "),_()?l.a.createElement("span",null,r.name):l.a.createElement(m.b,{to:"/narrative-context/".concat(n,"/").concat(a,"/").concat(r.id)},r.name)),l.a.createElement("div",{className:"textRight"},_()?l.a.createElement(z,{onClick:function(e){var n=window.prompt("Ingresa el nombre del nuevo elemento");if(n){var a=A.createElement(n,e);r.addElement(a),t.saveDB(),g()}}}):l.a.createElement(l.a.Fragment,null),l.a.createElement("button",{onClick:function(){return E(r)}},l.a.createElement(G,null),l.a.createElement("span",{className:"tooltip"},"Renombrar")),l.a.createElement("button",{onClick:function(){return c(r)}},l.a.createElement(q,null),l.a.createElement("span",{className:"tooltip"},"Subir")),l.a.createElement("button",{onClick:function(){return f(r)}},l.a.createElement(K,null),l.a.createElement("span",{className:"tooltip"},"Bajar")),l.a.createElement("button",{onClick:function(){return v(r)}},l.a.createElement(W,null),l.a.createElement("span",{className:"tooltip"},"Eliminar")))),_()?l.a.createElement("div",null,B?r.elements.map((function(e){return l.a.createElement(Z,{key:e.id,appContext:t,narrativeContextId:n,narrativeCategoryId:a,element:e,onMoveElementUp:S,onMoveElementDown:T,onDeleteElement:I,onRenameElement:P,onChildUpdate:g,tabElement:!0})})):l.a.createElement(l.a.Fragment,null)):l.a.createElement(l.a.Fragment,null))}function $(e){var t=e.appContext,n=e.narrativeContext,a=e.narrativeCategory,r=e.onCategoryChange,o=e.moveCategoryUp,c=e.moveCategoryDown,u=Object(i.useState)(a.elements),m=Object(s.a)(u,2),f=m[0],v=m[1],p=function(){v(Object(d.a)(a.elements)),setTimeout((function(){return v(a.elements)}),0)},E=function(e){window.confirm("Estas seguro de eliminar el elemento ".concat(e.name))&&(a.removeElement(e.id),t.saveDB(),p())},h=function(e){a.moveElementUp(e.id),t.saveDB(),p()},g=function(e){a.moveElementDown(e.id),t.saveDB(),p()},b=function(e){var n=window.prompt("Ingresa el nuevo nombre del elemento",e.name);n&&(e.name=n,t.saveDB(),r())};return l.a.createElement("div",{className:"NarrativeCategory"},l.a.createElement("div",{className:"flex"},l.a.createElement("h3",{className:"flex2"},a.name),l.a.createElement("div",{className:"textRight narrativeCategoryTitleButtons"},l.a.createElement(z,{onClick:function(e){var n=window.prompt("Ingresa el nombre del nuevo elemento");if(n){var r=A.createElement(n,e);a.addElement(r),t.saveDB(),p()}}}),l.a.createElement("button",{onClick:function(){var e=window.prompt("Ingresa el nuevo nombre de la categor\xeda",a.name);e&&(a.name=e,t.saveDB(),r())}},l.a.createElement(G,null),l.a.createElement("span",{className:"tooltip"},"Renombrar")),l.a.createElement("button",{onClick:function(){return o(a)}},l.a.createElement(q,null),l.a.createElement("span",{className:"tooltip"},"Subir")),l.a.createElement("button",{onClick:function(){return c(a)}},l.a.createElement(K,null),l.a.createElement("span",{className:"tooltip"},"Bajar")),l.a.createElement("button",{onClick:function(){window.confirm("Estas seguro de eliminar la categor\xeda ".concat(a.name))&&(n.removeNarrativeCategory(a.id),t.saveDB(),r())}},l.a.createElement(W,null),l.a.createElement("span",{className:"tooltip"},"Eliminar categor\xeda")))),l.a.createElement("div",{className:"narrativeCategoryElements"},f.map((function(e){return l.a.createElement(Z,{key:e.id,appContext:t,narrativeContextId:n.id,narrativeCategoryId:a.id,element:e,onMoveElementUp:h,onMoveElementDown:g,onDeleteElement:E,onRenameElement:b,onChildUpdate:p})}))))}function ee(){return l.a.createElement(E.a,{icon:p.i,color:"#6942f5"})}function te(e){var t=e.appContext,n=Object(f.g)(),a=Object(f.h)().narrativeContextId,r=Object(i.useState)(null),o=Object(s.a)(r,2),c=o[0],u=o[1],m=Object(i.useState)([]),v=Object(s.a)(m,2),p=v[0],E=v[1];Object(i.useEffect)((function(){t.setNarrativeContextById(a);var e=t.getDB().getNarrativeContext(a);u(e),E(e.categories),t.setBackButtonUrl("/"),t.setForwardButtonUrl(null)}),[t,a]);var h=function(){E(Object(d.a)(c.categories))},g=function(e){c.moveNarrativeCategoryUp(e.id),t.saveDB(),E(Object(d.a)(c.categories))},b=function(e){c.moveNarrativeCategoryDown(e.id),t.saveDB(),E(Object(d.a)(c.categories))};return l.a.createElement("div",{className:"ViewNarrativeContext"},l.a.createElement("div",{className:"flex narrativeContextTitleBar"},l.a.createElement("h1",{className:"flex2"},"world"===(null===c||void 0===c?void 0:c.type)?l.a.createElement("span",{role:"img","aria-label":"world"},"\ud83c\udf0e"):l.a.createElement("span",{role:"img","aria-label":"books"},"\ud83d\udcda")," ",null===c||void 0===c?void 0:c.name),l.a.createElement("div",{className:"textRight narrativeContextTitleButtons"},l.a.createElement("button",{onClick:function(){var e=window.prompt("Ingresa nombre de la categor\xeda");if(e){var n=new P(e),r=t.getDB().getNarrativeContext(a);r.addNarrativeCategory(n),t.saveDB(),E(Object(d.a)(r.categories))}}},l.a.createElement(H,null),l.a.createElement("span",{className:"tooltip"},"Crear categor\xeda")),l.a.createElement("button",{onClick:function(){var e=window.prompt("Ingresa el nuevo nombre de ".concat("world"===c.type?"el mundo":"la campa\xf1a"),c.name);e&&(c.name=e,t.saveDB(),u(Object(L.a)({},c)),t.setNarrativeContextById(null),setTimeout((function(){u(c),t.setNarrativeContextById(a)}),0))}},l.a.createElement(G,null),l.a.createElement("span",{className:"tooltip"},"Renombrar")),l.a.createElement("a",{hidden:!0,id:"narrativeContextDownloadLink"}),l.a.createElement("button",{onClick:function(){var e=document.getElementById("narrativeContextDownloadLink"),t=JSON.stringify(c.toJson(),null,2),n=new Blob([t],{type:"application/json"});e.href=URL.createObjectURL(n),e.download="".concat(R.TYPES.find((function(e){return e.type===c.type})).name," - ").concat(c.name,".json"),e.click()}},l.a.createElement(ee,null),l.a.createElement("span",{className:"tooltip"},"Exportar")),l.a.createElement("button",{onClick:function(){window.confirm("Estas seguro que deseas eliminar ".concat("world"===c.type?"el mundo":"la campa\xf1a"," ").concat(c.name))&&(t.getDB().removeNarrativeContext(a),t.saveDB(),n("/"))}},l.a.createElement(W,null),l.a.createElement("span",{className:"tooltip"},"Eliminar")))),p.map((function(e){return l.a.createElement($,{key:e.id,appContext:t,narrativeCategory:e,narrativeContext:c,onCategoryChange:h,moveCategoryUp:g,moveCategoryDown:b})})))}n(71);var ne=function(){function e(){Object(b.a)(this,e),this.campaigns=null,this.worlds=null,this.campaigns=[],this.worlds=[]}return Object(y.a)(e,[{key:"getNarrativeContext",value:function(e){return this.campaigns.concat(this.worlds).find((function(t){return t.id===e}))}},{key:"addNarrativeContext",value:function(e){"world"===e.type?this.addWorld(e):this.addCampaign(e)}},{key:"removeNarrativeContext",value:function(e){var t=this.getNarrativeContext(e),n=null;(n="world"===t.type?this.worlds:this.campaigns).splice(n.indexOf(t),1)}},{key:"addWorld",value:function(e){this.worlds.push(e)}},{key:"addCampaign",value:function(e){this.campaigns.push(e)}},{key:"toJson",value:function(){return{campaigns:this.campaigns.map((function(e){return e.toJson()})),worlds:this.worlds.map((function(e){return e.toJson()}))}}}],[{key:"fromJson",value:function(t){var n=new e;return n.campaigns=t.campaigns.map((function(e){return R.fromJson(e)})),n.worlds=t.worlds.map((function(e){return R.fromJson(e)})),n}}]),e}(),ae=n(49),re=-1!==window.location.origin.indexOf("localhost")?"http://localhost:5000/api":"https://narrativetools.herokuapp.com/api",oe=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,[{key:"_get_token",value:function(){return localStorage.getItem("token")}},{key:"_get",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var n,a,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={"Content-Type":"application/json"},(a=this._get_token())&&(n.Authorization=a),e.next=5,fetch("".concat(re).concat(t),{method:"GET",headers:n});case 5:if(!(o=e.sent).ok){e.next=10;break}return e.next=9,o.json();case 9:return e.abrupt("return",e.sent);case 10:return e.next=12,o.json();case 12:throw e.sent;case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_post",value:function(){var e=Object(o.a)(r.a.mark((function e(t,n){var a,o,i,l,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={"Content-Type":"application/json"},(o=this._get_token())&&(a.Authorization=o),i=JSON.stringify(n),l=null,"string"===typeof i&&i.length>1024?(a["Content-Encoding"]="gzip",l=ae.a.gzip(i)):(a["Content-Encoding"]=void 0,l=i),e.next=8,fetch("".concat(re).concat(t),{method:"POST",body:l,headers:a});case 8:if(!(c=e.sent).ok){e.next=13;break}return e.next=12,c.json();case 12:return e.abrupt("return",e.sent);case 13:return e.next=15,c.json();case 15:throw e.sent;case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_put",value:function(){var e=Object(o.a)(r.a.mark((function e(t,n){var a,o,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={"Content-Type":"application/json"},(o=this._get_token())&&(a.Authorization=o),e.next=5,fetch("".concat(re).concat(t),{method:"PUT",body:JSON.stringify(n),headers:a});case 5:if(!(i=e.sent).ok){e.next=10;break}return e.next=9,i.json();case 9:return e.abrupt("return",e.sent);case 10:return e.next=12,i.json();case 12:throw e.sent;case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_delete",value:function(){var e=Object(o.a)(r.a.mark((function e(t,n){var a,o,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={"Content-Type":"application/json"},(o=this._get_token())&&(a.Authorization=o),e.next=5,fetch("".concat(re).concat(t),{method:"DELETE",body:JSON.stringify(n),headers:a});case 5:if(!(i=e.sent).ok){e.next=10;break}return e.next=9,i.json();case 9:return e.abrupt("return",e.sent);case 10:return e.next=12,i.json();case 12:throw e.sent;case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),ie=function(e){Object(B.a)(n,e);var t=Object(N.a)(n);function n(){return Object(b.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"pullDB",value:function(){var e=Object(o.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._get("/database");case 2:if(t=e.sent,0!==Object.keys(t).length){e.next=5;break}return e.abrupt("return",null);case 5:return e.abrupt("return",ne.fromJson(t));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"pushDB",value:function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._post("/database",t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(oe),le=function(){function e(){Object(b.a)(this,e),e._db=new ne}return Object(y.a)(e,[{key:"tryGetCloudDB",value:function(){var t=Object(o.a)(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._tryDownloadCloudDB();case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"registerOnCloudDBDownloadedHook",value:function(t){e._onCloudDBDownloadedHooks.push(t)}},{key:"registerAfterSaveHook",value:function(t){e._afterSaveHooks.push(t)}},{key:"registerOnDirtyDBCallback",value:function(t){e._onDirtyDBCallback=t}},{key:"enableSavingPrevention",value:function(){e._preventSave=!0}},{key:"save",value:function(){e._save()}}],[{key:"_tryDownloadCloudDB",value:function(){var t=Object(o.a)(r.a.mark((function t(){var n,a,o;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Downloading remote DB"),t.next=3,e._dbSyncRepository.pullDB();case 3:if(n=t.sent){e._db=n,a=Object(j.a)(e._onCloudDBDownloadedHooks);try{for(a.s();!(o=a.n()).done;)(0,o.value)()}catch(r){a.e(r)}finally{a.f()}}case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"_save",value:function(){var t=Object(o.a)(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._preventSave){t.next=3;break}return e._onDirtyDBCallback(),t.abrupt("return");case 3:return e.setUpdatingDBIndicator(!0),t.next=6,e._dbSyncRepository.pushDB(e._db.toJson());case 6:e._callAfterSaveHooks(),e.setUpdatingDBIndicator(!1);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"_callAfterSaveHooks",value:function(){var t,n=Object(j.a)(e._afterSaveHooks);try{for(n.s();!(t=n.n()).done;){(0,t.value)()}}catch(a){n.e(a)}finally{n.f()}}}]),e}();le._DB_KEY="db",le._db=null,le._afterSaveHooks=[],le._preventSave=!1,le._onDirtyDBCallback=function(){},le._dbSyncRepository=new ie,le._onCloudDBDownloadedHooks=[],le.setUpdatingDBIndicator=function(e){};var ce=n(50),ue=n.n(ce);n(77);function se(e){var t=e.onChange,n=e.initialValue,a=Object(i.useRef)(),r=0,o=function(){var e;e=r+=1,setTimeout((function(){if(e===r){if(!a.current.getContents)return;t(a.current.getContents())}}),200)};return l.a.createElement("div",{className:"EditorContainer"},l.a.createElement(ue.a,{lang:"es",defaultValue:n,height:function(){var e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return e<=640?"48vh":e<=900?"67vh":"73vh"}(),onChange:function(e){return o()},onInput:function(e){return o()},getSunEditorInstance:function(e){a.current=e},setOptions:{buttonList:[["formatBlock","bold","underline","italic","strike"],["fontColor","hiliteColor"],["removeFormat"],["align","horizontalRule","list"],["table","link","image","video","audio"],["fullScreen","codeView"]],formats:[{tag:"p",name:"P\xe1rrafo"},{tag:"h1",name:"T\xedtulo"},{tag:"h2",name:"Subt\xedtulo"},{tag:"h3",name:"Secci\xf3n"},{tag:"h4",name:"Subsecci\xf3n"},{tag:"blockquote",name:"Bloque de descripci\xf3n"},{tag:"pre",name:"Notas de DM"}]}}))}n(47);function me(e){var t=e.appContext,n=e.element,a=e.parentExposedFuntions,r=Object(i.useState)(!1),o=Object(s.a)(r,2),c=o[0],u=o[1],m=null,f=!1,d=function(){m=null,u(!1)};return a.edit=function(){u(!0)},l.a.createElement("div",{className:"ParagraphElement"},c?l.a.createElement(l.a.Fragment,null,l.a.createElement("button",{onClick:function(){f?(n.body=m,t.saveDBAsync(),u(!1)):d()}},l.a.createElement("span",{role:"img","aria-label":"save"},"\ud83d\udcbe")," Guardar cambios"),l.a.createElement("button",{onClick:d},l.a.createElement("span",{role:"img","aria-label":"cancel"},"\u274c")," Descartar cambios")):l.a.createElement(l.a.Fragment,null),c?l.a.createElement(l.a.Fragment,null,l.a.createElement(se,{onChange:function(e){f=!0,m=e},initialValue:n.body})):l.a.createElement("div",{dangerouslySetInnerHTML:{__html:n.body}}))}n(78);function fe(e){e.appContext;var t=e.items,n=e.onItemsChange,a=void 0===n?function(e){}:n,r=e.parentExposedFuntions,o=Object(i.useState)((null===t||void 0===t?void 0:t.map((function(e){return e.clone()})))||[]),c=Object(s.a)(o,2),u=c[0],m=c[1],f=function(e,t,n){e[t]=n,a(Object(d.a)(u)),m(Object(d.a)(u))};return r.addItem=function(){u.push(new S),a(Object(d.a)(u)),m(Object(d.a)(u))},l.a.createElement("div",{className:"ShopTableEditor"},l.a.createElement("table",{className:"shopTable"},l.a.createElement("tbody",null,l.a.createElement("tr",null,l.a.createElement("th",null,"Objeto"),l.a.createElement("th",null,"Enlace"),l.a.createElement("th",null,"Precio"),l.a.createElement("th",null,"Cantidad disponible"),l.a.createElement("th",null)),null===u||void 0===u?void 0:u.map((function(e){return l.a.createElement("tr",{key:e.id},l.a.createElement("td",null,l.a.createElement("input",{key:"".concat(e.id,"-titleInput"),onChange:function(t){return f(e,"title",t.target.value)},value:e.title||""})),l.a.createElement("td",null,l.a.createElement("input",{key:"".concat(e.id,"-linkInput"),onChange:function(t){return f(e,"link",t.target.value)},value:e.link||""})),l.a.createElement("td",null,l.a.createElement("input",{key:"".concat(e.id,"-priceInput"),onChange:function(t){return f(e,"price",t.target.value)},value:e.price||""})),l.a.createElement("td",null,l.a.createElement("input",{type:"number",key:"".concat(e.id,"-amountInput"),onChange:function(t){return f(e,"amount",parseInt(t.target.value))},value:e.amount||0})),l.a.createElement("td",null,l.a.createElement("button",{onClick:function(){return t=e,u.splice(u.indexOf(t),1),a(Object(d.a)(u)),void m(Object(d.a)(u));var t}},l.a.createElement("span",{role:"img","aria-label":"delete"},"\ud83d\uddd1\ufe0f"))))})))))}function de(e){var t=e.appContext,n=e.element,a=e.parentExposedFuntions,r=Object(i.useState)(!1),o=Object(s.a)(r,2),c=o[0],u=o[1],m=null,f=!1,d={},v=function(){m=[],u(!1)};return a.edit=function(){u(!0)},l.a.createElement("div",{className:"ParagraphElement"},c?l.a.createElement(l.a.Fragment,null,l.a.createElement("button",{onClick:function(){d.addItem()}},l.a.createElement("span",{role:"img","aria-label":"plus"},"\u2795")," Agregar objeto"),l.a.createElement("button",{onClick:function(){f?(n.items=m,t.saveDBAsync(),u(!1)):v()}},l.a.createElement("span",{role:"img","aria-label":"save"},"\ud83d\udcbe")," Guardar cambios"),l.a.createElement("button",{onClick:v},l.a.createElement("span",{role:"img","aria-label":"cancel"},"\u274c")," Descartar cambios")):l.a.createElement(l.a.Fragment,null),l.a.createElement("br",null),c?l.a.createElement(l.a.Fragment,null,l.a.createElement(fe,{items:n.items,onItemsChange:function(e){f=!0,m=e},parentExposedFuntions:d})):l.a.createElement("table",{className:"shopTable"},l.a.createElement("tbody",null,l.a.createElement("tr",null,l.a.createElement("th",null,"Objeto"),l.a.createElement("th",null,"Precio"),l.a.createElement("th",null,"Cantidad disponible")),n.items.map((function(e){return l.a.createElement("tr",{key:e.id},l.a.createElement("td",null,e.link?l.a.createElement("a",{href:e.link},e.title):l.a.createElement("span",null,e.title)),l.a.createElement("td",null,e.price),l.a.createElement("td",null,e.amount))})))))}function ve(){return l.a.createElement(E.a,{icon:p.h,color:"#574a6b"})}function pe(){return l.a.createElement(E.a,{icon:p.n,color:"#424242"})}function Ee(e){var t=e.appContext,n=Object(f.g)(),a=Object(f.h)(),r=a.narrativeContextId,o=a.narrativeCategoryId,c=a.elementId,u=Object(i.useState)(null),m=Object(s.a)(u,2),d=m[0],v=m[1],p={};Object(i.useEffect)((function(){t.setNarrativeContextById(r);var e=t.getDB().getNarrativeContext(r).getNarrativeCategory(o).findElementAnywhere(c);v(e),function(){var e=t.getDB().getNarrativeContext(r).getNarrativeCategory(o),n=e.getPrevElement(c,r),a=e.getNextElement(c,r);n?t.setBackButtonUrl("/narrative-context/".concat(r,"/").concat(o,"/").concat(n.id)):t.setBackButtonUrl("/narrative-context/".concat(r)),a?t.setForwardButtonUrl("/narrative-context/".concat(r,"/").concat(o,"/").concat(a.id)):t.setForwardButtonUrl(null)}()}),[t,r,o,c]);var E=function(){window.confirm("Estas seguro de eliminar el elemento ".concat(d.name))&&(t.getDB().getNarrativeContext(r).getNarrativeCategory(o).removeElement(d.id),t.saveDB(),n("/narrative-context/".concat(r)))};return l.a.createElement("div",{className:"ViewElement"},d?l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"flex viewElementTitleBar"},l.a.createElement("h2",{className:"flex2"},d.name),l.a.createElement("div",{className:"textRight viewElementTitleButtons"},l.a.createElement("button",{onClick:function(){var e=window.prompt("Ingresa el nuevo nombre del elemento",d.name);if(e){var n=t.getDB().getNarrativeContext(r).getNarrativeCategory(o).findElementAnywhere(c);n.name=e,t.saveDB(),v(Object(L.a)({},n)),setTimeout((function(){v(n)}),0)}}},l.a.createElement(G,null),l.a.createElement("span",{className:"tooltip"},"Renombrar")),l.a.createElement("button",{onClick:function(){p.edit()}},l.a.createElement(ve,null),l.a.createElement("span",{className:"tooltip"},"Editar")),l.a.createElement("button",{onClick:function(){var e="".concat(window.location.origin,"/narrative-context/").concat(r,"/").concat(o,"/").concat(c);navigator.clipboard.writeText(e)}},l.a.createElement(pe,null),l.a.createElement("span",{className:"tooltip"},"Copiar enlace")))),{paragraph:l.a.createElement(me,{key:d.id,appContext:t,element:d,onDelete:E,parentExposedFuntions:p}),shop:l.a.createElement(de,{key:d.id,appContext:t,element:d,onDelete:E,parentExposedFuntions:p})}[d.type]):l.a.createElement(l.a.Fragment,null))}n(79),n(80);var he=function(e){Object(B.a)(n,e);var t=Object(N.a)(n);function n(){var e;Object(b.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).onLogin=function(){},e.onLogout=function(){},e}return Object(y.a)(n,[{key:"login",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._post("/auth/login",t);case 2:n=e.sent,localStorage.setItem("token",n.token),localStorage.setItem("tokenUsername",t.username),this.onLogin();case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isAuthenticated",value:function(){return!!localStorage.getItem("token")}},{key:"getAuthenticatedUsername",value:function(){return localStorage.getItem("tokenUsername")}},{key:"logout",value:function(){localStorage.removeItem("token"),localStorage.removeItem("tokenUsername"),this.onLogout()}}]),n}(oe);function ge(){return l.a.createElement(E.a,{icon:p.u})}function be(){return l.a.createElement(E.a,{icon:p.r,color:"#424242"})}function ye(e){var t=e.appContext,n=Object(i.useRef)();return l.a.createElement("div",{className:"SessionMenuButton"},l.a.createElement("button",{className:"sessionIconButton",onClick:function(){n.current.classList.toggle("showDropdownBody")}},l.a.createElement(ge,null)),l.a.createElement("div",{ref:n,className:"dropdownBody"},l.a.createElement("button",{onClick:function(){t.getRepository(he).logout()}},l.a.createElement(be,null)," Cerrar sesi\xf3n")))}function ke(e){var t=e.appContext,n=Object(i.useState)("/"),a=Object(s.a)(n,2),r=a[0],o=a[1],c=Object(i.useState)("/"),u=Object(s.a)(c,2),f=u[0],d=u[1],v=Object(i.useState)(null),h=Object(s.a)(v,2),g=h[0],b=h[1];return t.setBackButtonUrl=o,t.setForwardButtonUrl=d,t.setNarrativeContextById=function(e){var n=null;e&&(n=t.getDB().getNarrativeContext(e)),b(n)},l.a.createElement("div",{className:"Navbar"},l.a.createElement("div",{className:"navbarContent"},l.a.createElement("div",{className:"flex1"},l.a.createElement(m.b,{to:"/",id:"homeTitleLink"},l.a.createElement(E.a,{icon:p.g})," Inicio")),l.a.createElement("div",{className:"textCenter"},g?l.a.createElement(m.b,{to:"/narrative-context/".concat(g.id),id:"narrativeContextTitleLink"},g.name):l.a.createElement(l.a.Fragment,null)),l.a.createElement("div",{className:"flex2 textRight",id:"nabvarNavigationIcons"},l.a.createElement("span",{className:"iconButton ".concat(r?"iconButtonActive":"iconButtonInactive")},r?l.a.createElement(m.b,{to:r},l.a.createElement(E.a,{icon:p.b})):l.a.createElement(E.a,{icon:p.b,className:"inactiveLink"})),l.a.createElement("span",null," "),l.a.createElement("span",{className:"iconButton ".concat(f?"iconButtonActive":"iconButtonInactive")},f?l.a.createElement(m.b,{to:f},l.a.createElement(E.a,{icon:p.c})):l.a.createElement(E.a,{icon:p.c,className:"inactiveLink"})),t.getRepository(he).isAuthenticated()?l.a.createElement(ye,{appContext:t}):l.a.createElement(l.a.Fragment,null))))}n(81);function Ce(e){var t=e.appContext,n=Object(i.useState)(null),a=Object(s.a)(n,2),c=a[0],u=a[1],m=Object(i.useState)(null),f=Object(s.a)(m,2),d=f[0],v=f[1];Object(i.useEffect)((function(){t.setBackButtonUrl(null),t.setForwardButtonUrl(null)}),[t]);var p=function(){var e=Object(o.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.getRepository(he).login({username:c,password:d});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),alert("Usuario o contrese\xf1a inv\xe1lidos!");case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(){return e.apply(this,arguments)}}();return l.a.createElement("form",{className:"LoginView",onSubmit:function(e){return e.preventDefault()}},l.a.createElement("input",{type:"text",name:"username",onChange:function(e){return u(e.target.value)},placeholder:"Usuario"}),l.a.createElement("input",{type:"password",name:"password",onChange:function(e){return v(e.target.value)},placeholder:"Contrase\xf1a"}),l.a.createElement("button",{type:"submit",onClick:p},"Iniciar sesi\xf3n"))}function je(e){var t=e.appContext;return Object(i.useEffect)((function(){t.setBackButtonUrl(null),t.setForwardButtonUrl(null),t.getRepository(he).logout()}),[t]),l.a.createElement(l.a.Fragment,null)}n(82);function Oe(){return l.a.createElement("div",{className:"UpdatingDBIndicator"},l.a.createElement(E.a,{className:"updatingDBIcon",icon:p.f}))}function xe(e){var t=e.appContext,n=t.getRepository(he),a=Object(i.useState)(n.isAuthenticated()),r=Object(s.a)(a,2),o=r[0],c=(r[1],Object(i.useState)(!1)),u=Object(s.a)(c,2),d=u[0],v=u[1];return t.setUpdatingDBIndicator=v,l.a.createElement("div",{className:"App"},d?l.a.createElement(Oe,null):l.a.createElement(l.a.Fragment,null),l.a.createElement(m.a,null,l.a.createElement(ke,{appContext:t}),l.a.createElement("div",{className:"RouterContainer"},l.a.createElement(f.d,null,o?l.a.createElement(l.a.Fragment,null,l.a.createElement(f.b,{path:"/create-narrative-context",element:l.a.createElement(F,{appContext:t})}),l.a.createElement(f.b,{path:"/narrative-context/:narrativeContextId/:narrativeCategoryId/:elementId",element:l.a.createElement(Ee,{appContext:t})}),l.a.createElement(f.b,{path:"/narrative-context/:narrativeContextId",element:l.a.createElement(te,{appContext:t})}),l.a.createElement(f.b,{path:"/logout",element:l.a.createElement(je,{appContext:t})}),l.a.createElement(f.b,{path:"/",element:l.a.createElement(J,{appContext:t})}),l.a.createElement(f.b,{path:"*",element:l.a.createElement(f.a,{to:"/"})})):l.a.createElement(l.a.Fragment,null,l.a.createElement(f.b,{path:"/login",element:l.a.createElement(Ce,{appContext:t})}),l.a.createElement(f.b,{path:"*",element:l.a.createElement(f.a,{to:"/login"})}),l.a.createElement(f.b,{path:"/",element:l.a.createElement(f.a,{to:"/login"})}))))))}var we=function(){function e(){Object(b.a)(this,e),this._repositories=null,this.setUpdatingDBIndicator=function(e){},this._repositories={}}return Object(y.a)(e,[{key:"getRepository",value:function(e){return this._repositories[e]||(this._repositories[e]=new e),this._repositories[e]}},{key:"setBackButtonUrl",value:function(e){}},{key:"setForwardButtonUrl",value:function(e){}},{key:"setNarrativeContextById",value:function(e){}},{key:"getDB",value:function(){return le._db}},{key:"saveDBAsync",value:function(){var e=this;setTimeout((function(){return e.saveDB()}),0)}},{key:"saveDB",value:function(){var e=Object(o.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return le.setUpdatingDBIndicator=this.setUpdatingDBIndicator,e.prev=1,e.next=4,le._save();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),alert("Ha ocurrido un error al tratar de enviar los cambios al servidor de la aplicaci\xf3n!");case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(){return e.apply(this,arguments)}}()}]),e}(),Be=function(){function e(t){Object(b.a)(this,e),this._appContext=null,this._interval=null,this._INTERVAL_TIME=2e3,this._lastDBSaveTime=null,this._LAST_SAVE_DATE_KEY="last_save_date",this._appContext=t,this._lastDBSaveTime=this._getStoredDate(),this._registerAfterSaveHook(),this._registerOnDirtyDBCallback()}return Object(y.a)(e,[{key:"_registerAfterSaveHook",value:function(){var e=this;this._appContext.getRepository(le).registerAfterSaveHook((function(){e._updateLastSaveInfo()}))}},{key:"_registerOnDirtyDBCallback",value:function(){var e=this;this._appContext.getRepository(le).registerOnDirtyDBCallback((function(){e._onDirtyDB()}))}},{key:"_updateLastSaveInfo",value:function(){var e=new Date;this._lastDBSaveTime=e,localStorage.setItem(this._LAST_SAVE_DATE_KEY,e.toString())}},{key:"_getStoredDate",value:function(){var e=localStorage.getItem(this._LAST_SAVE_DATE_KEY);return e?new Date(e):null}},{key:"_isWorkingDirty",value:function(){var e=this._getStoredDate();return e&&!this._lastDBSaveTime||e&&this._lastDBSaveTime&&this._lastDBSaveTime<e}},{key:"start",value:function(){var e=this;this._interval=setInterval((function(){e._isWorkingDirty()&&(e._appContext.getRepository(le).enableSavingPrevention(),clearInterval(e._interval),e._onDirtyDB())}),this._INTERVAL_TIME)}},{key:"_onDirtyDB",value:function(){window.confirm("Usted esta trabajando con una version desactualizada de la base de datos local y no podra guardar cambios en esta. Por favor recargue la aplicaci\xf3n para poder volver a utilizarla con normalidad o haga click en aceptar / ok para hacerlo autom\xe1ticamente.")&&window.location.reload()}}]),e}(),Ne=new we,De=new Be(Ne),_e=Ne.getRepository(le),Ie=Ne.getRepository(he),Se=function(){var e=Object(o.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!Ie.isAuthenticated()){e.next=4;break}return e.next=4,_e.tryGetCloudDB();case 4:De.start(),u.a.render(l.a.createElement(xe,{appContext:Ne}),document.getElementById("root")),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),alert("Ha ocurrido un error al sincronizar con el servidor, por favor refresca la p\xe1gina!");case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();Ie.onLogin=function(){window.location="/"},Ie.onLogout=function(){window.location="/login"},Se()}},[[52,1,2]]]);
//# sourceMappingURL=main.2e53cc4a.chunk.js.map