(this["webpackJsonpreact-dnd"]=this["webpackJsonpreact-dnd"]||[]).push([[0],{48:function(e,t,n){},53:function(e,t,n){e.exports=n(87)},55:function(e,t,n){},60:function(e,t,n){},61:function(e,t,n){},62:function(e,t,n){},68:function(e,t,n){},69:function(e,t,n){},70:function(e,t,n){},71:function(e,t,n){},72:function(e,t,n){},73:function(e,t,n){},76:function(e,t,n){var a={"./ckb.js":25,"./da.js":26,"./de.js":27,"./en.js":18,"./es.js":28,"./fr.js":29,"./he.js":30,"./index.js":77,"./it.js":31,"./ja.js":32,"./ko.js":33,"./lv.js":34,"./nl.js":35,"./pl.js":36,"./pt_br.js":37,"./ro.js":38,"./ru.js":39,"./se.js":40,"./ua.js":41,"./zh_cn.js":42};function r(e){var t=o(e);return n(t)}function o(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}r.keys=function(){return Object.keys(a)},r.resolve=o,e.exports=r,r.id=76},79:function(e,t,n){},81:function(e,t,n){},82:function(e,t,n){},83:function(e,t,n){},84:function(e,t,n){},85:function(e,t,n){},86:function(e,t,n){},87:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n.n(a),o=n(9),c=(n(55),n(0)),i=n.n(c),l=n(49),u=n.n(l),s=n(1),m=(n(60),n(61),n(10)),d=n(7),v=n(11),f=(n(62),[{name:"5e Tools",url:"https://5e.tools/"},{name:"Bestiario (5e Tools)",url:"https://5e.tools/bestiary.html"},{name:"Objetos mundanos y m\xe1gicos (5e Tools)",url:"https://5e.tools/items.html"},{name:"Calculadora de encuentros",url:"https://kastark.co.uk/rpgs/encounter-calculator-5th/"},{name:"Tabla de encuentros aleatorios (5e Tools)",url:"https://5e.tools/encountergen.html"},{name:"Generador de nombres",url:"https://www.fantasynamegen.com/"},{name:"Razas",url:"https://www.dndbeyond.com/races"},{name:"Clases",url:"https://www.dndbeyond.com/classes"}]),p=n(4),h=n(3);function E(){return i.a.createElement(h.a,{icon:p.d,color:"#72b52f"})}function g(){return i.a.createElement(h.a,{icon:p.j,color:"#6942f5"})}var b=n(5),y=n(6),k=n(12),C=n(92),x=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,null,[{key:"generateId",value:function(){return Object(C.a)()}}]),e}(),j=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,null,[{key:"moveElementInArray",value:function(e,t,n){if(n>=e.length)for(var a=n-e.length+1;a--;)e.push(void 0);e.splice(n,0,e.splice(t,1)[0])}}]),e}(),O=n(22),w=n(16),_=n(15),B=n(14),N=function(){function e(t,n){Object(b.a)(this,e),this.id=null,this.name=null,this.type=null,this.id=x.generateId(),this.name=t,this.type=n}return Object(y.a)(e,[{key:"toJson",value:function(){return{id:this.id,name:this.name,type:this.type}}}],[{key:"fromJson",value:function(e){throw Error("This method should not be used!")}}]),e}();N.TYPES={PARAGRAPH:"paragraph",CONTAINER:"container",SHOP:"shop"};var D=function(e){Object(_.a)(n,e);var t=Object(B.a)(n);function n(e){var a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Object(b.a)(this,n),(a=t.call(this,e,N.TYPES.PARAGRAPH)).body=null,a.body=r,a}return Object(y.a)(n,[{key:"toJson",value:function(){var e=Object(O.a)(Object(w.a)(n.prototype),"toJson",this).call(this);return e.body=this.body,e}}],[{key:"fromJson",value:function(e){return new n(e.name,e.body)}}]),n}(N),I=function(e){Object(_.a)(n,e);var t=Object(B.a)(n);function n(e){var a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(b.a)(this,n),(a=t.call(this,e,N.TYPES.CONTAINER)).elements=null,a.elements=r,a}return Object(y.a)(n,[{key:"getElement",value:function(e){return this.elements.find((function(t){return t.id===e}))}},{key:"addElement",value:function(e){this.elements.push(e)}},{key:"removeElement",value:function(e){var t=this.getElement(e);this.elements.splice(this.elements.indexOf(t),1)}},{key:"moveElementUp",value:function(e){var t=this.elements.indexOf(this.elements.find((function(t){return t.id===e}))),n=t-1;0!==t&&j.moveElementInArray(this.elements,t,n)}},{key:"moveElementDown",value:function(e){var t=this.elements.indexOf(this.elements.find((function(t){return t.id===e}))),n=t+1;n!==this.elements.length&&j.moveElementInArray(this.elements,t,n)}},{key:"findInChild",value:function(e){var t,n=Object(k.a)(this.elements);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a.id===e)return a;if(a.findInChild){var r=a.findInChild(e);if(r)return r}}}catch(o){n.e(o)}finally{n.f()}return null}},{key:"getPlainViewableElements",value:function(){var e,t=[],n=Object(k.a)(this.elements);try{for(n.s();!(e=n.n()).done;){var a=e.value;a.type===N.TYPES.CONTAINER?t=t.concat(a.getPlainViewableElements()):t.push(a)}}catch(r){n.e(r)}finally{n.f()}return t}},{key:"toJson",value:function(){var e=Object(O.a)(Object(w.a)(n.prototype),"toJson",this).call(this);return e.elements=this.elements.map((function(e){return e.toJson()})),e}}],[{key:"fromJson",value:function(e){return new n(e.name,(e.elements||[]).map((function(e){return A.mapElementFromJson(e)})))}}]),n}(N),S=function(){function e(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(b.a)(this,e),this.id=null,this.title=null,this.price=null,this.link=null,this.amount=0,this.id=x.generateId(),this.title=t,this.price=n,this.link=a,this.amount=r}return Object(y.a)(e,[{key:"clone",value:function(){return e.fromJson(this.toJson())}},{key:"toJson",value:function(){return{id:this.id,title:this.title,price:this.price,link:this.link,amount:this.amount}}}],[{key:"fromJson",value:function(t){var n=new e(t.title,t.price,t.link,t.amount);return n.id=t.id,n}}]),e}(),T=function(e){Object(_.a)(n,e);var t=Object(B.a)(n);function n(e){var a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(b.a)(this,n),(a=t.call(this,e,N.TYPES.SHOP)).items=null,a.items=r,a}return Object(y.a)(n,[{key:"toJson",value:function(){var e=Object(O.a)(Object(w.a)(n.prototype),"toJson",this).call(this);return e.items=this.items.map((function(e){return e.toJson()})),e}}],[{key:"fromJson",value:function(e){return new n(e.name,e.items.map((function(e){return S.fromJson(e)})))}}]),n}(N),A=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,null,[{key:"mapElementFromJson",value:function(e){var t=this._ELEMENT_TYPES_MAPPING[e.type].fromJson(e);return t.id=e.id,t}},{key:"createElement",value:function(e,t){return new this._ELEMENT_TYPES_MAPPING[t](e)}}]),e}();A._ELEMENT_TYPES_MAPPING={paragraph:D,container:I,shop:T};var P=function(){function e(t){Object(b.a)(this,e),this.id=null,this.type=null,this.elements=null,this.id=x.generateId(),this.name=t,this.elements=[]}return Object(y.a)(e,[{key:"getElement",value:function(e){return this.elements.find((function(t){return t.id===e}))}},{key:"findElementAnywhere",value:function(e){var t,n=Object(k.a)(this.elements);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a.id===e)return a;if(a.findInChild){var r=a.findInChild(e);if(r)return r}}}catch(o){n.e(o)}finally{n.f()}return null}},{key:"addElement",value:function(e){this.elements.push(e)}},{key:"removeElement",value:function(e){var t=this.getElement(e);this.elements.splice(this.elements.indexOf(t),1)}},{key:"moveElementUp",value:function(e){var t=this.elements.indexOf(this.elements.find((function(t){return t.id===e}))),n=t-1;0!==t&&j.moveElementInArray(this.elements,t,n)}},{key:"moveElementDown",value:function(e){var t=this.elements.indexOf(this.elements.find((function(t){return t.id===e}))),n=t+1;n!==this.elements.length&&j.moveElementInArray(this.elements,t,n)}},{key:"getPlainViewableElements",value:function(){var e,t=[],n=Object(k.a)(this.elements);try{for(n.s();!(e=n.n()).done;){var a=e.value;a.type===N.TYPES.CONTAINER?t=t.concat(a.getPlainViewableElements()):t.push(a)}}catch(r){n.e(r)}finally{n.f()}return t}},{key:"getPrevElement",value:function(e){var t=this.getPlainViewableElements(),n=t.indexOf(t.find((function(t){return t.id===e})));return 0===n?null:t[n-1]}},{key:"getNextElement",value:function(e){var t=this.getPlainViewableElements(),n=t.indexOf(t.find((function(t){return t.id===e})));return n===t.length-1?null:t[n+1]}},{key:"toJson",value:function(){return{id:this.id,name:this.name,elements:this.elements.map((function(e){return e.toJson()}))}}}],[{key:"fromJson",value:function(t){var n=new e(t.name);return n.id=t.id,n.elements=t.elements.map((function(e){return A.mapElementFromJson(e)})),n}}]),e}(),R=function(){function e(t,n){if(Object(b.a)(this,e),this.id=null,this.type=null,this.name=null,this.categories=null,!e.TYPES.find((function(e){return e.type===t})))throw Error("Invalid type");this.id=x.generateId(),this.type=t,this.name=n,this.categories=[]}return Object(y.a)(e,[{key:"getNarrativeCategory",value:function(e){return this.categories.find((function(t){return t.id===e}))}},{key:"addNarrativeCategory",value:function(e){this.categories.push(e)}},{key:"removeNarrativeCategory",value:function(e){var t=this.getNarrativeCategory(e);this.categories.splice(this.categories.indexOf(t),1)}},{key:"moveNarrativeCategoryUp",value:function(e){var t=this.categories.indexOf(this.categories.find((function(t){return t.id===e}))),n=t-1;0!==t&&j.moveElementInArray(this.categories,t,n)}},{key:"moveNarrativeCategoryDown",value:function(e){var t=this.categories.indexOf(this.categories.find((function(t){return t.id===e}))),n=t+1;n!==this.categories.length&&j.moveElementInArray(this.categories,t,n)}},{key:"searchTerm",value:function(e){var t,n=[],a=Object(k.a)(this.categories);try{for(a.s();!(t=a.n()).done;){var r=t.value;n=n.concat(r.getPlainViewableElements())}}catch(c){a.e(c)}finally{a.f()}var o=function(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")};return n.filter((function(t){return o(t.name).includes(o(e))}))}},{key:"getNarrativeCategoryByElementId",value:function(e){var t,n=Object(k.a)(this.categories);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a.findElementAnywhere(e))return a}}catch(r){n.e(r)}finally{n.f()}return null}},{key:"toJson",value:function(){return{id:this.id,type:this.type,name:this.name,categories:this.categories.map((function(e){return e.toJson()}))}}}],[{key:"fromJson",value:function(t){var n=new e(t.type,t.name);return n.id=t.id,n.categories=t.categories.map((function(e){return P.fromJson(e)})),n}}]),e}();R.TYPES=[{type:"world",name:"Mundo"},{type:"campaign",name:"Campa\xf1a"}];var U=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,null,[{key:"importFromJson",value:function(e,t){var n=null;try{n=R.fromJson(JSON.parse(e))}catch(a){return void alert("Ha ocurrido un error al importar el contexto narrativo. El formato del archivo no parece ser v\xe1lido!")}t.getDB().getNarrativeContext(n.id)?alert("Ha ocurrido un error al importar el contexto narrativo. Parece ser que posees otro contexto narrativo con el mismo identificador!"):(t.getDB().addNarrativeContext(n),alert("La importaci\xf3n fue realizada con \xe9xito!"),t.saveDB())}}]),e}();function F(e){var t=e.appContext,n=Object(d.g)(),a=Object(c.useState)([]),l=Object(s.a)(a,2),u=l[0],p=l[1],h=Object(c.useState)([]),b=Object(s.a)(h,2),y=b[0],k=b[1];Object(c.useEffect)((function(){t.setNarrativeContextById(null),t.setBackButtonUrl(null),t.setForwardButtonUrl(null);var e=t.getDB();p(e.campaigns),k(e.worlds)}),[t]);var C=function(){var e=Object(o.a)(r.a.mark((function e(n){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.preventDefault(),(a=new FileReader).onload=function(){var e=Object(o.a)(r.a.mark((function e(n){var a,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n.target.result,U.importFromJson(a,t),o=t.getDB(),p(Object(v.a)(o.campaigns)),k(Object(v.a)(o.worlds)),setTimeout((function(){p(o.campaigns),k(o.worlds)}),0),document.getElementById("narrativeContextFileSelector").value=null;case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.readAsText(n.target.files[0]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return i.a.createElement("div",null,i.a.createElement("div",{className:"homeTitleSection"},i.a.createElement("h1",{className:"flex1"},"Contextos narrativos"),i.a.createElement("div",{className:"homeTitleButtons"},i.a.createElement("button",{onClick:function(){n("/create-narrative-context")}},i.a.createElement(E,null)," Crear"),i.a.createElement("input",{type:"file",id:"narrativeContextFileSelector",hidden:!0,onChange:C,accept:"application/json"}),i.a.createElement("button",{onClick:function(){return document.getElementById("narrativeContextFileSelector").click()}},i.a.createElement(g,null)," Importar"))),i.a.createElement("h2",null,i.a.createElement("span",{role:"img","aria-label":"books"},"\ud83d\udcda")," Campa\xf1as"),i.a.createElement("ul",null,u.map((function(e){return i.a.createElement("li",{key:e.id},i.a.createElement(m.b,{to:"/narrative-context/".concat(e.id)},e.name))}))),i.a.createElement("h2",null,i.a.createElement("span",{role:"img","aria-label":"world"},"\ud83c\udf0e")," Mundos"),i.a.createElement("ul",null,y.map((function(e){return i.a.createElement("li",{key:e.id},i.a.createElement(m.b,{to:"/narrative-context/".concat(e.id)},e.name))}))),i.a.createElement("h2",null,i.a.createElement("span",{role:"img","aria-label":"tools"},"\u2692\ufe0f")," Herramientas"),i.a.createElement("ul",null,f.map((function(e){return i.a.createElement("li",{key:e.name},i.a.createElement("a",{href:e.url},e.name))}))))}function J(e){var t=e.appContext,n=Object(d.g)(),a=Object(c.useState)(),r=Object(s.a)(a,2),o=r[0],l=r[1],u=Object(c.useState)(R.TYPES[0].type),m=Object(s.a)(u,2),v=m[0],f=m[1];Object(c.useEffect)((function(){t.setNarrativeContextById(null)}),[t]);return i.a.createElement("div",null,i.a.createElement("h1",null,"Crear contexto narrativo"),i.a.createElement("input",{type:"text",placeholder:"Nombre",onChange:function(e){return l(e.target.value)}}),i.a.createElement("select",{onChange:function(e){return f(e.target.value)}},R.TYPES.map((function(e){return i.a.createElement("option",{key:e.type,value:e.type},e.name)}))),i.a.createElement("button",{onClick:function(){var e=new R(v,o);t.getDB().addNarrativeContext(e),t.saveDB(),n("/")}},"Crear"))}var L=n(44);n(68),n(69),n(70);function H(){return i.a.createElement(h.a,{icon:p.o,color:"#2b3340"})}function Y(){return i.a.createElement(h.a,{icon:p.p,color:"#baa28f"})}function M(){return i.a.createElement(h.a,{icon:p.k,color:"#FACC30"})}function V(){return i.a.createElement(h.a,{icon:p.q,color:"#609fbf"})}function z(e){var t=e.onClick,n=void 0===t?function(e){}:t,a=Object(c.useRef)(),r=function(e){a.current.classList.toggle("showDropdownBody"),n(e)};return i.a.createElement("div",{className:"CreateElementButton"},i.a.createElement("button",{onClick:function(){a.current.classList.toggle("showDropdownBody")}},i.a.createElement(H,null),i.a.createElement("span",{className:"tooltip"},"Crear elemento")),i.a.createElement("div",{ref:a,className:"dropdownBody"},i.a.createElement("button",{onClick:function(){return r(N.TYPES.PARAGRAPH)}},i.a.createElement(Y,null)," Texto"),i.a.createElement("button",{onClick:function(){return r(N.TYPES.CONTAINER)}},i.a.createElement(M,null)," Contenedor"),i.a.createElement("button",{onClick:function(){return r(N.TYPES.SHOP)}},i.a.createElement(V,null)," Tienda")))}n(71);function K(){return i.a.createElement(h.a,{icon:p.s,color:"#fcba03"})}function G(){return i.a.createElement(h.a,{icon:p.m,color:"#012452"})}function q(){return i.a.createElement(h.a,{icon:p.l,color:"#012452"})}function W(){return i.a.createElement(h.a,{icon:p.t,color:"#98a3b3"})}function Z(){return i.a.createElement(h.a,{icon:p.a,color:"#424242"})}function Q(){return i.a.createElement(h.a,{icon:p.e,color:"#424242"})}function X(e){var t=e.appContext,n=e.narrativeContextId,a=e.narrativeCategoryId,r=e.element,o=e.onMoveElementUp,l=void 0===o?function(e){}:o,u=e.onMoveElementDown,d=void 0===u?function(e){}:u,v=e.onDeleteElement,f=void 0===v?function(e){}:v,p=e.onRenameElement,h=void 0===p?function(e){}:p,E=e.onChildUpdate,g=void 0===E?function(){}:E,b=e.tabElement,y=void 0!==b&&b,k=Object(c.useState)(!1),C=Object(s.a)(k,2),x=C[0],j=C[1],O=Object(c.useState)(t.elementListItemExpandedStatuses[r.id]||!1),w=Object(s.a)(O,2),_=w[0],B=w[1],D=function(){return r.type===N.TYPES.CONTAINER},I=function(e){window.confirm("Estas seguro de eliminar el elemento ".concat(e.name))&&(r.removeElement(e.id),t.saveDB(),g())},S=function(e){r.moveElementUp(e.id),t.saveDB(),g()},T=function(e){r.moveElementDown(e.id),t.saveDB(),g()},P=function(e){var n=window.prompt("Ingresa el nuevo nombre del elemento",e.name);n&&(e.name=n,t.saveDB(),g())};return i.a.createElement("div",{className:y?"listItemTabbed":"",onMouseEnter:function(){j(!0)},onMouseLeave:function(){j(!1)}},i.a.createElement("div",{className:"flex "+(x?"highlightedListItem":"")},D()?i.a.createElement("button",{className:"collapseExpandButton",onClick:function(){return B(!_),void(t.elementListItemExpandedStatuses[r.id]=!_)}},_?i.a.createElement(Z,null):i.a.createElement(Q,null)):i.a.createElement(i.a.Fragment,null),i.a.createElement("div",{className:"flex2 elementListItemName "},i.a.createElement("span",{role:"img","aria-label":"icon"},function(){var e={};return e[N.TYPES.PARAGRAPH]=i.a.createElement(Y,null),e[N.TYPES.CONTAINER]=i.a.createElement(M,null),e[N.TYPES.SHOP]=i.a.createElement(V,null),e[r.type]}()," "),D()?i.a.createElement("span",null,r.name):i.a.createElement(m.b,{to:"/narrative-context/".concat(n,"/").concat(a,"/").concat(r.id)},r.name)),i.a.createElement("div",{className:"textRight"},D()?i.a.createElement(z,{onClick:function(e){var n=window.prompt("Ingresa el nombre del nuevo elemento");if(n){var a=A.createElement(n,e);r.addElement(a),t.saveDB(),g()}}}):i.a.createElement(i.a.Fragment,null),i.a.createElement("button",{onClick:function(){return h(r)}},i.a.createElement(K,null),i.a.createElement("span",{className:"tooltip"},"Renombrar")),i.a.createElement("button",{onClick:function(){return l(r)}},i.a.createElement(G,null),i.a.createElement("span",{className:"tooltip"},"Subir")),i.a.createElement("button",{onClick:function(){return d(r)}},i.a.createElement(q,null),i.a.createElement("span",{className:"tooltip"},"Bajar")),i.a.createElement("button",{onClick:function(){return f(r)}},i.a.createElement(W,null),i.a.createElement("span",{className:"tooltip"},"Eliminar")))),D()?i.a.createElement("div",null,_?r.elements.map((function(e){return i.a.createElement(X,{key:e.id,appContext:t,narrativeContextId:n,narrativeCategoryId:a,element:e,onMoveElementUp:S,onMoveElementDown:T,onDeleteElement:I,onRenameElement:P,onChildUpdate:g,tabElement:!0})})):i.a.createElement(i.a.Fragment,null)):i.a.createElement(i.a.Fragment,null))}function $(e){var t=e.appContext,n=e.narrativeContext,a=e.narrativeCategory,r=e.onCategoryChange,o=e.moveCategoryUp,l=e.moveCategoryDown,u=Object(c.useState)(a.elements),m=Object(s.a)(u,2),d=m[0],f=m[1],p=function(){f(Object(v.a)(a.elements)),setTimeout((function(){return f(a.elements)}),0)},h=function(e){window.confirm("Estas seguro de eliminar el elemento ".concat(e.name))&&(a.removeElement(e.id),t.saveDB(),p())},E=function(e){a.moveElementUp(e.id),t.saveDB(),p()},g=function(e){a.moveElementDown(e.id),t.saveDB(),p()},b=function(e){var n=window.prompt("Ingresa el nuevo nombre del elemento",e.name);n&&(e.name=n,t.saveDB(),r())};return i.a.createElement("div",{className:"NarrativeCategory"},i.a.createElement("div",{className:"flex"},i.a.createElement("h3",{className:"flex2"},a.name),i.a.createElement("div",{className:"textRight narrativeCategoryTitleButtons"},i.a.createElement(z,{onClick:function(e){var n=window.prompt("Ingresa el nombre del nuevo elemento");if(n){var r=A.createElement(n,e);a.addElement(r),t.saveDB(),p()}}}),i.a.createElement("button",{onClick:function(){var e=window.prompt("Ingresa el nuevo nombre de la categor\xeda",a.name);e&&(a.name=e,t.saveDB(),r())}},i.a.createElement(K,null),i.a.createElement("span",{className:"tooltip"},"Renombrar")),i.a.createElement("button",{onClick:function(){return o(a)}},i.a.createElement(G,null),i.a.createElement("span",{className:"tooltip"},"Subir")),i.a.createElement("button",{onClick:function(){return l(a)}},i.a.createElement(q,null),i.a.createElement("span",{className:"tooltip"},"Bajar")),i.a.createElement("button",{onClick:function(){window.confirm("Estas seguro de eliminar la categor\xeda ".concat(a.name))&&(n.removeNarrativeCategory(a.id),t.saveDB(),r())}},i.a.createElement(W,null),i.a.createElement("span",{className:"tooltip"},"Eliminar categor\xeda")))),i.a.createElement("div",{className:"narrativeCategoryElements"},d.map((function(e){return i.a.createElement(X,{key:e.id,appContext:t,narrativeContextId:n.id,narrativeCategoryId:a.id,element:e,onMoveElementUp:E,onMoveElementDown:g,onDeleteElement:h,onRenameElement:b,onChildUpdate:p})}))))}function ee(){return i.a.createElement(h.a,{icon:p.i,color:"#6942f5"})}function te(e){var t=e.appContext,n=Object(d.g)(),a=Object(d.h)().narrativeContextId,r=Object(c.useState)(null),o=Object(s.a)(r,2),l=o[0],u=o[1],m=Object(c.useState)([]),f=Object(s.a)(m,2),p=f[0],h=f[1];Object(c.useEffect)((function(){t.setNarrativeContextById(a);var e=t.getDB().getNarrativeContext(a);u(e),h(e.categories),t.setBackButtonUrl("/"),t.setForwardButtonUrl(null)}),[t,a]);var E=function(){h(Object(v.a)(l.categories))},g=function(e){l.moveNarrativeCategoryUp(e.id),t.saveDB(),h(Object(v.a)(l.categories))},b=function(e){l.moveNarrativeCategoryDown(e.id),t.saveDB(),h(Object(v.a)(l.categories))};return i.a.createElement("div",{className:"ViewNarrativeContext"},i.a.createElement("div",{className:"flex narrativeContextTitleBar"},i.a.createElement("h1",{className:"flex2"},"world"===(null===l||void 0===l?void 0:l.type)?i.a.createElement("span",{role:"img","aria-label":"world"},"\ud83c\udf0e"):i.a.createElement("span",{role:"img","aria-label":"books"},"\ud83d\udcda")," ",null===l||void 0===l?void 0:l.name),i.a.createElement("div",{className:"textRight narrativeContextTitleButtons"},i.a.createElement("button",{onClick:function(){var e=window.prompt("Ingresa nombre de la categor\xeda");if(e){var n=new P(e),r=t.getDB().getNarrativeContext(a);r.addNarrativeCategory(n),t.saveDB(),h(Object(v.a)(r.categories))}}},i.a.createElement(H,null),i.a.createElement("span",{className:"tooltip"},"Crear categor\xeda")),i.a.createElement("button",{onClick:function(){var e=window.prompt("Ingresa el nuevo nombre de ".concat("world"===l.type?"el mundo":"la campa\xf1a"),l.name);e&&(l.name=e,t.saveDB(),u(Object(L.a)({},l)),t.setNarrativeContextById(null),setTimeout((function(){u(l),t.setNarrativeContextById(a)}),0))}},i.a.createElement(K,null),i.a.createElement("span",{className:"tooltip"},"Renombrar")),i.a.createElement("a",{hidden:!0,id:"narrativeContextDownloadLink",href:"/"}," "),i.a.createElement("button",{onClick:function(){var e=document.getElementById("narrativeContextDownloadLink"),t=JSON.stringify(l.toJson(),null,2),n=new Blob([t],{type:"application/json"});e.href=URL.createObjectURL(n),e.download="".concat(R.TYPES.find((function(e){return e.type===l.type})).name," - ").concat(l.name,".json"),e.click()}},i.a.createElement(ee,null),i.a.createElement("span",{className:"tooltip"},"Exportar")),i.a.createElement("button",{onClick:function(){window.confirm("Estas seguro que deseas eliminar ".concat("world"===l.type?"el mundo":"la campa\xf1a"," ").concat(l.name))&&(t.getDB().removeNarrativeContext(a),t.saveDB(),n("/"))}},i.a.createElement(W,null),i.a.createElement("span",{className:"tooltip"},"Eliminar")))),p.map((function(e){return i.a.createElement($,{key:e.id,appContext:t,narrativeCategory:e,narrativeContext:l,onCategoryChange:E,moveCategoryUp:g,moveCategoryDown:b})})))}n(72),n(48),n(73);var ne=n(50),ae=n.n(ne);function re(e){var t=e.onChange,n=e.initialValue,a=Object(c.useRef)(),r=0,o=function(){var e;e=r+=1,setTimeout((function(){if(e===r){if(!a.current.getContents)return;t(a.current.getContents())}}),200)};return i.a.createElement("div",{className:"EditorContainer"},i.a.createElement(ae.a,{lang:"es",defaultValue:n,height:function(){var e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return e<=640?"48vh":e<=900?"67vh":"73vh"}(),onChange:function(e){return o()},onInput:function(e){return o()},getSunEditorInstance:function(e){a.current=e},setOptions:{buttonList:[["formatBlock","bold","underline","italic","strike"],["fontColor","hiliteColor"],["removeFormat"],["align","horizontalRule","list"],["table","link","image","video","audio"],["fullScreen","codeView"]],formats:[{tag:"p",name:"P\xe1rrafo"},{tag:"h1",name:"T\xedtulo"},{tag:"h2",name:"Subt\xedtulo"},{tag:"h3",name:"Secci\xf3n"},{tag:"h4",name:"Subsecci\xf3n"},{tag:"blockquote",name:"Bloque de descripci\xf3n"},{tag:"pre",name:"Notas de DM"}]}}))}var oe=n(52),ce=-1!==window.location.origin.indexOf("localhost")?"http://localhost:5000/api":"https://narrativetools.herokuapp.com/api",ie=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,[{key:"_get_token",value:function(){return localStorage.getItem("token")}},{key:"_get",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var n,a,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={"Content-Type":"application/json"},(a=this._get_token())&&(n.Authorization=a),e.next=5,fetch("".concat(ce).concat(t),{method:"GET",headers:n});case 5:if(!(o=e.sent).ok){e.next=10;break}return e.next=9,o.json();case 9:return e.abrupt("return",e.sent);case 10:return e.next=12,o.json();case 12:throw e.sent;case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_post",value:function(){var e=Object(o.a)(r.a.mark((function e(t,n){var a,o,c,i,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={"Content-Type":"application/json"},(o=this._get_token())&&(a.Authorization=o),c=JSON.stringify(n),i=null,"string"===typeof c&&c.length>1024?(a["Content-Encoding"]="gzip",i=oe.a.gzip(c)):(a["Content-Encoding"]=void 0,i=c),e.next=8,fetch("".concat(ce).concat(t),{method:"POST",body:i,headers:a});case 8:if(!(l=e.sent).ok){e.next=13;break}return e.next=12,l.json();case 12:return e.abrupt("return",e.sent);case 13:return e.next=15,l.json();case 15:throw e.sent;case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_put",value:function(){var e=Object(o.a)(r.a.mark((function e(t,n){var a,o,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={"Content-Type":"application/json"},(o=this._get_token())&&(a.Authorization=o),e.next=5,fetch("".concat(ce).concat(t),{method:"PUT",body:JSON.stringify(n),headers:a});case 5:if(!(c=e.sent).ok){e.next=10;break}return e.next=9,c.json();case 9:return e.abrupt("return",e.sent);case 10:return e.next=12,c.json();case 12:throw e.sent;case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_delete",value:function(){var e=Object(o.a)(r.a.mark((function e(t,n){var a,o,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={"Content-Type":"application/json"},(o=this._get_token())&&(a.Authorization=o),e.next=5,fetch("".concat(ce).concat(t),{method:"DELETE",body:JSON.stringify(n),headers:a});case 5:if(!(c=e.sent).ok){e.next=10;break}return e.next=9,c.json();case 9:return e.abrupt("return",e.sent);case 10:return e.next=12,c.json();case 12:throw e.sent;case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),le=function(e){Object(_.a)(n,e);var t=Object(B.a)(n);function n(){return Object(b.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"getCharacter",value:function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n._characters[t]){e.next=4;break}return e.next=3,this._get("/dnd_5e/characters/".concat(t));case 3:n._characters[t]=e.sent;case 4:return e.abrupt("return",n._characters[t]);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(ie);le._characters={};n(79);function ue(e){var t=e.character;return i.a.createElement("div",{className:"CharacterStatBlock"},i.a.createElement("h1",null,i.a.createElement("a",{href:"https://nivel20.com/games/dnd-5/characters/".concat(t.character_id)},t.name)),i.a.createElement("div",null,i.a.createElement("i",null,t.class," ",t.race,", ",t.alignment)),i.a.createElement("div",{className:"divider"}),i.a.createElement("div",null,i.a.createElement("b",null,"Clase de armadura "),i.a.createElement("span",null,t.armor_class)),i.a.createElement("div",null,i.a.createElement("b",null,"Puntos de golpe "),i.a.createElement("span",null,t.max_hp)),i.a.createElement("div",null,i.a.createElement("b",null,"Velocidad "),i.a.createElement("span",null,t.speed," pies")),i.a.createElement("div",null,i.a.createElement("b",null,"Bono de competencia "),i.a.createElement("span",null,"+",t.proficiency_bonus)),i.a.createElement("table",null,i.a.createElement("tbody",null,i.a.createElement("tr",null,t.ability_scores.map((function(e){return i.a.createElement("th",{key:"".concat(t.name,"_").concat(e.name,"_title")},i.a.createElement("b",null,e.name.toUpperCase().substring(0,3)))}))),i.a.createElement("tr",null,t.ability_scores.map((function(e){return i.a.createElement("td",{key:"".concat(t.name,"_").concat(e.name,"_score")},e.value," (",e.modifier>=0?"+":"",e.modifier,")")}))))),i.a.createElement("div",null,i.a.createElement("b",null,"Tiradas de salvaci\xf3n ")," ",i.a.createElement("span",null,t.saving_throws.filter((function(e){return e.has_proficiency})).map((function(e){return"".concat(e.name," ").concat(e.modifier>=0?"+":"").concat(e.modifier)})).join(", "))),i.a.createElement("div",null,i.a.createElement("b",null,"Habilidades con competencia ")," ",i.a.createElement("span",null,t.skills.filter((function(e){return e.has_proficiency})).map((function(e){return"".concat(e.name," ").concat(e.modifier>=0?"+":"").concat(e.modifier)})).join(", "))),i.a.createElement("div",null,i.a.createElement("b",null,"Sentidos ")," ",i.a.createElement("span",null,function(){var e=10+t.skills.find((function(e){return"Percepci\xf3n"===e.name})).modifier;return"Percepci\xf3n pasiva ".concat(e)}())),i.a.createElement("div",null,i.a.createElement("b",null,"Idiomas ")," ",i.a.createElement("span",null,t.languages)),null===t.spellcasting?i.a.createElement(i.a.Fragment,null):i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"divider"}),i.a.createElement("div",null,i.a.createElement("b",null,"Lanzamiento de conjuros "),"La habilidad de lanzamiento de conjuros de ",t.name," es ",t.spellcasting.spellcasting_ability," (CD de salvaci\xf3n de conjuros ",t.spellcasting.saving_throws_cd,", ",t.spellcasting.attack_bonus>=0?"+":"",t.spellcasting.attack_bonus," para golpear con ataques de conjuro). ",t.name," tiene acceso a los siguientes conjuros:",Object.keys(t.spellcasting.spell_levels).map((function(e){return parseInt(e)})).map((function(e){return 0===t.spellcasting.spell_levels[e].max_spell_slots?null:i.a.createElement("div",{key:"".concat(t.name,"_spell_level_").concat(e)},i.a.createElement("i",null,0===e?"Trucos (a voluntad)":"Nivel ".concat(e," (").concat(t.spellcasting.spell_levels[e].max_spell_slots," espacios): ")),t.spellcasting.spell_levels[e].spells.join(", "))})))))}var se=n(47),me=n.n(se);function de(e){var t=e.appContext,n=e.body,a=Object(c.useState)(),l=Object(s.a)(a,2),u=l[0],m=l[1],d=null;Object(c.useEffect)((function(){d=p(),m(d)}),[m,d]);var v=function(){var e=Object(o.a)(r.a.mark((function e(n){var a,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.getRepository(le),e.next=3,a.getCharacter(n);case 3:o=e.sent,document.getElementById(n).innerHTML=me.a.renderToString(i.a.createElement(ue,{character:o}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),f=function(e){if(e){var t,n=e.matchAll(/\[C\]\{([a-zA-Z0-9\-]+)\}/gm),a=e,r=Object(k.a)(n);try{var o=function(){var e,n=t.value;a=a.replace(n[0],(e=n[1],me.a.renderToString(i.a.createElement("div",{id:e})))),setTimeout((function(){return v(n[1])}),0)};for(r.s();!(t=r.n()).done;)o()}catch(c){r.e(c)}finally{r.f()}return a}},p=function(){return f(n)};return i.a.createElement("div",{dangerouslySetInnerHTML:{__html:u}})}function ve(e){var t=e.appContext,n=e.element,a=e.parentExposedFuntions,r=Object(c.useState)(!1),o=Object(s.a)(r,2),l=o[0],u=o[1],m=null,d=!1,v=function(){m=null,u(!1)};return a.edit=function(){u(!0)},i.a.createElement("div",{className:"ParagraphElement"},l?i.a.createElement(i.a.Fragment,null,i.a.createElement("button",{onClick:function(){d?(n.body=m,t.saveDBAsync(),u(!1)):v()}},i.a.createElement("span",{role:"img","aria-label":"save"},"\ud83d\udcbe")," Guardar cambios"),i.a.createElement("button",{onClick:v},i.a.createElement("span",{role:"img","aria-label":"cancel"},"\u274c")," Descartar cambios")):i.a.createElement(i.a.Fragment,null),l?i.a.createElement(i.a.Fragment,null,i.a.createElement(re,{onChange:function(e){d=!0,m=e},initialValue:n.body})):i.a.createElement(de,{appContext:t,body:n.body}))}n(81);function fe(e){e.appContext;var t=e.items,n=e.onItemsChange,a=void 0===n?function(e){}:n,r=e.parentExposedFuntions,o=Object(c.useState)((null===t||void 0===t?void 0:t.map((function(e){return e.clone()})))||[]),l=Object(s.a)(o,2),u=l[0],m=l[1],d=function(e,t,n){e[t]=n,a(Object(v.a)(u)),m(Object(v.a)(u))};return r.addItem=function(){u.push(new S),a(Object(v.a)(u)),m(Object(v.a)(u))},i.a.createElement("div",{className:"ShopTableEditor"},i.a.createElement("table",{className:"shopTable"},i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("th",null,"Objeto"),i.a.createElement("th",null,"Enlace"),i.a.createElement("th",null,"Precio"),i.a.createElement("th",null,"Cantidad disponible"),i.a.createElement("th",null)),null===u||void 0===u?void 0:u.map((function(e){return i.a.createElement("tr",{key:e.id},i.a.createElement("td",null,i.a.createElement("input",{key:"".concat(e.id,"-titleInput"),onChange:function(t){return d(e,"title",t.target.value)},value:e.title||""})),i.a.createElement("td",null,i.a.createElement("input",{key:"".concat(e.id,"-linkInput"),onChange:function(t){return d(e,"link",t.target.value)},value:e.link||""})),i.a.createElement("td",null,i.a.createElement("input",{key:"".concat(e.id,"-priceInput"),onChange:function(t){return d(e,"price",t.target.value)},value:e.price||""})),i.a.createElement("td",null,i.a.createElement("input",{type:"number",key:"".concat(e.id,"-amountInput"),onChange:function(t){return d(e,"amount",parseInt(t.target.value))},value:e.amount||0})),i.a.createElement("td",null,i.a.createElement("button",{onClick:function(){return t=e,u.splice(u.indexOf(t),1),a(Object(v.a)(u)),void m(Object(v.a)(u));var t}},i.a.createElement("span",{role:"img","aria-label":"delete"},"\ud83d\uddd1\ufe0f"))))})))))}function pe(e){var t=e.appContext,n=e.element,a=e.parentExposedFuntions,r=Object(c.useState)(!1),o=Object(s.a)(r,2),l=o[0],u=o[1],m=null,d=!1,v={},f=function(){m=[],u(!1)};return a.edit=function(){u(!0)},i.a.createElement("div",{className:"ParagraphElement"},l?i.a.createElement(i.a.Fragment,null,i.a.createElement("button",{onClick:function(){v.addItem()}},i.a.createElement("span",{role:"img","aria-label":"plus"},"\u2795")," Agregar objeto"),i.a.createElement("button",{onClick:function(){d?(n.items=m,t.saveDBAsync(),u(!1)):f()}},i.a.createElement("span",{role:"img","aria-label":"save"},"\ud83d\udcbe")," Guardar cambios"),i.a.createElement("button",{onClick:f},i.a.createElement("span",{role:"img","aria-label":"cancel"},"\u274c")," Descartar cambios")):i.a.createElement(i.a.Fragment,null),i.a.createElement("br",null),l?i.a.createElement(i.a.Fragment,null,i.a.createElement(fe,{items:n.items,onItemsChange:function(e){d=!0,m=e},parentExposedFuntions:v})):i.a.createElement("table",{className:"shopTable"},i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("th",null,"Objeto"),i.a.createElement("th",null,"Precio"),i.a.createElement("th",null,"Cantidad disponible")),n.items.map((function(e){return i.a.createElement("tr",{key:e.id},i.a.createElement("td",null,e.link?i.a.createElement("a",{href:e.link},e.title):i.a.createElement("span",null,e.title)),i.a.createElement("td",null,e.price),i.a.createElement("td",null,e.amount))})))))}function he(){return i.a.createElement(h.a,{icon:p.h,color:"#574a6b"})}function Ee(){return i.a.createElement(h.a,{icon:p.n,color:"#424242"})}function ge(e){var t=e.appContext,n=Object(d.g)(),a=Object(d.h)(),r=a.narrativeContextId,o=a.narrativeCategoryId,l=a.elementId,u=Object(c.useState)(null),m=Object(s.a)(u,2),v=m[0],f=m[1],p={};Object(c.useEffect)((function(){t.setNarrativeContextById(r);var e=t.getDB().getNarrativeContext(r).getNarrativeCategory(o).findElementAnywhere(l);f(e),function(){var e=t.getDB().getNarrativeContext(r).getNarrativeCategory(o),n=e.getPrevElement(l,r),a=e.getNextElement(l,r);n?t.setBackButtonUrl("/narrative-context/".concat(r,"/").concat(o,"/").concat(n.id)):t.setBackButtonUrl("/narrative-context/".concat(r)),a?t.setForwardButtonUrl("/narrative-context/".concat(r,"/").concat(o,"/").concat(a.id)):t.setForwardButtonUrl(null)}()}),[t,r,o,l]);var h=function(){window.confirm("Estas seguro de eliminar el elemento ".concat(v.name))&&(t.getDB().getNarrativeContext(r).getNarrativeCategory(o).removeElement(v.id),t.saveDB(),n("/narrative-context/".concat(r)))};return i.a.createElement("div",{className:"ViewElement"},v?i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"flex viewElementTitleBar"},i.a.createElement("h2",{className:"flex2"},v.name),i.a.createElement("div",{className:"textRight viewElementTitleButtons"},i.a.createElement("button",{onClick:function(){var e=window.prompt("Ingresa el nuevo nombre del elemento",v.name);if(e){var n=t.getDB().getNarrativeContext(r).getNarrativeCategory(o).findElementAnywhere(l);n.name=e,t.saveDB(),f(Object(L.a)({},n)),setTimeout((function(){f(n)}),0)}}},i.a.createElement(K,null),i.a.createElement("span",{className:"tooltip"},"Renombrar")),i.a.createElement("button",{onClick:function(){p.edit()}},i.a.createElement(he,null),i.a.createElement("span",{className:"tooltip"},"Editar")),i.a.createElement("button",{onClick:function(){var e="".concat(window.location.origin,"/narrative-context/").concat(r,"/").concat(o,"/").concat(l);navigator.clipboard.writeText(e)}},i.a.createElement(Ee,null),i.a.createElement("span",{className:"tooltip"},"Copiar enlace")))),{paragraph:i.a.createElement(ve,{key:v.id,appContext:t,element:v,onDelete:h,parentExposedFuntions:p}),shop:i.a.createElement(pe,{key:v.id,appContext:t,element:v,onDelete:h,parentExposedFuntions:p})}[v.type]):i.a.createElement(i.a.Fragment,null))}n(82),n(83);var be=function(e){Object(_.a)(n,e);var t=Object(B.a)(n);function n(){var e;Object(b.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).onLogin=function(){},e.onLogout=function(){},e}return Object(y.a)(n,[{key:"login",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._post("/auth/login",t);case 2:n=e.sent,localStorage.setItem("token",n.token),localStorage.setItem("tokenUsername",t.username),this.onLogin();case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isAuthenticated",value:function(){return!!localStorage.getItem("token")}},{key:"getAuthenticatedUsername",value:function(){return localStorage.getItem("tokenUsername")}},{key:"logout",value:function(){localStorage.removeItem("token"),localStorage.removeItem("tokenUsername"),this.onLogout()}}]),n}(ie);function ye(){return i.a.createElement(h.a,{icon:p.u})}function ke(){return i.a.createElement(h.a,{icon:p.r,color:"#424242"})}function Ce(e){var t=e.appContext,n=Object(c.useRef)();return i.a.createElement("div",{className:"SessionMenuButton"},i.a.createElement("button",{className:"sessionIconButton",onClick:function(){n.current.classList.toggle("showDropdownBody")}},i.a.createElement(ye,null)),i.a.createElement("div",{ref:n,className:"dropdownBody"},i.a.createElement("button",{onClick:function(){t.getRepository(be).logout()}},i.a.createElement(ke,null)," Cerrar sesi\xf3n")))}function xe(e){var t=e.appContext,n=Object(c.useState)("/"),a=Object(s.a)(n,2),r=a[0],o=a[1],l=Object(c.useState)("/"),u=Object(s.a)(l,2),v=u[0],f=u[1],E=Object(c.useState)(null),g=Object(s.a)(E,2),b=g[0],y=g[1],k=Object(d.g)();return t.setBackButtonUrl=o,t.setForwardButtonUrl=f,t._setNarrativeContextById=function(e){var n=null;e&&(n=t.getDB().getNarrativeContext(e)),y(n)},t.navigateToPreviousElement=function(){r&&k(r)},t.navigateToNextElement=function(){v&&k(v)},i.a.createElement("div",{className:"Navbar"},i.a.createElement("div",{className:"navbarContent"},i.a.createElement("div",{className:"flex1"},i.a.createElement(m.b,{to:"/",id:"homeTitleLink"},i.a.createElement(h.a,{icon:p.g})," Inicio")),i.a.createElement("div",{className:"textCenter"},b?i.a.createElement(m.b,{to:"/narrative-context/".concat(b.id),id:"narrativeContextTitleLink"},b.name):i.a.createElement(i.a.Fragment,null)),i.a.createElement("div",{className:"flex2 textRight",id:"nabvarNavigationIcons"},i.a.createElement("span",{className:"iconButton ".concat(r?"iconButtonActive":"iconButtonInactive")},r?i.a.createElement(m.b,{to:r},i.a.createElement(h.a,{icon:p.b})):i.a.createElement(h.a,{icon:p.b,className:"inactiveLink"})),i.a.createElement("span",null," "),i.a.createElement("span",{className:"iconButton ".concat(v?"iconButtonActive":"iconButtonInactive")},v?i.a.createElement(m.b,{to:v},i.a.createElement(h.a,{icon:p.c})):i.a.createElement(h.a,{icon:p.c,className:"inactiveLink"})),t.getRepository(be).isAuthenticated()?i.a.createElement(Ce,{appContext:t}):i.a.createElement(i.a.Fragment,null))))}n(84);function je(e){var t=e.appContext,n=Object(c.useState)(null),a=Object(s.a)(n,2),l=a[0],u=a[1],m=Object(c.useState)(null),d=Object(s.a)(m,2),v=d[0],f=d[1];Object(c.useEffect)((function(){t.setBackButtonUrl(null),t.setForwardButtonUrl(null)}),[t]);var p=function(){var e=Object(o.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.getRepository(be).login({username:l,password:v});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),alert("Usuario o contrese\xf1a inv\xe1lidos!");case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(){return e.apply(this,arguments)}}();return i.a.createElement("form",{className:"LoginView",onSubmit:function(e){return e.preventDefault()}},i.a.createElement("input",{type:"text",name:"username",onChange:function(e){return u(e.target.value)},placeholder:"Usuario"}),i.a.createElement("input",{type:"password",name:"password",onChange:function(e){return f(e.target.value)},placeholder:"Contrase\xf1a"}),i.a.createElement("button",{type:"submit",onClick:p},"Iniciar sesi\xf3n"))}function Oe(e){var t=e.appContext;return Object(c.useEffect)((function(){t.setBackButtonUrl(null),t.setForwardButtonUrl(null),t.getRepository(be).logout()}),[t]),i.a.createElement(i.a.Fragment,null)}n(85);function we(){return i.a.createElement("div",{className:"UpdatingDBIndicator"},i.a.createElement(h.a,{className:"updatingDBIcon",icon:p.f}))}n(86);var _e=[],Be=-1;function Ne(e){var t=e.appContext,n=Object(d.g)(),a=Object(c.useState)([]),r=Object(s.a)(a,2),o=r[0],l=r[1],u=Object(c.useState)(-1),v=Object(s.a)(u,2),f=v[0],p=v[1],h=function(e){var n=t.getDB().getNarrativeContext(t.getNarrativeContextId()).getNarrativeCategoryByElementId(e.id);return"/narrative-context/".concat(t.getNarrativeContextId(),"/").concat(n.id,"/").concat(e.id)},E=function(e){return"ArrowUp"===e.key?(e.preventDefault(),0!==_e.length?(--Be<0&&(Be=0),p(Be)):p(Be=-1),void g()):"ArrowDown"===e.key?(e.preventDefault(),0!==_e.length?(++Be>_e.length-1&&(Be=_e.length-1),p(Be)):p(Be=-1),void g()):"Enter"===e.key?(e.preventDefault(),void(-1!==Be&&(n(h(_e[Be])),t.hideSearchBar()))):void 0},g=function(){var e=document.getElementById("searchResult_".concat(Be));e&&e.scrollIntoView(!0)};Object(c.useEffect)((function(){return document.addEventListener("keydown",E),function(){document.removeEventListener("keydown",E)}}),[_e,Be]);return i.a.createElement("div",{className:"SearchBar"},i.a.createElement("div",{className:"searchBarInputContainer"},i.a.createElement("input",{autoFocus:!0,key:"searchBarTextInput",onChange:function(e){return function(e){if(!e)return Be=-1,l(_e=[]),void p(Be);var n=t.getDB(),a=t.getNarrativeContextId();if(a){var r=n.searchTerm(e,a);_e=r,Be=r.length>0?0:-1}else _e=[],Be=-1;l(_e),p(Be)}(e.target.value)},placeholder:"Ingrese el t\xe9rmino a buscar",className:"searchBarInput"})),i.a.createElement("div",{className:"searchResultsContainer"},o.map((function(e,n){return i.a.createElement("div",{className:n===f?"searchResult searchResultSelected":"searchResult",id:"searchResult_".concat(n),key:"searchResult_".concat(n)},i.a.createElement(m.b,{to:h(e),onClick:function(){return t.hideSearchBar()}},e.name))}))))}function De(e){var t=e.appContext,n=t.getRepository(be),a=Object(c.useState)(n.isAuthenticated()),r=Object(s.a)(a,1)[0],o=Object(c.useState)(!1),l=Object(s.a)(o,2),u=l[0],v=l[1],f=Object(c.useState)(!1),p=Object(s.a)(f,2),h=p[0],E=p[1];return t.setUpdatingDBIndicator=v,t.showSearchBar=function(){return E(!0)},t.hideSearchBar=function(){return E(!1)},i.a.createElement("div",{className:"App"},u?i.a.createElement(we,null):i.a.createElement(i.a.Fragment,null),i.a.createElement(m.a,null,i.a.createElement(xe,{appContext:t}),h?i.a.createElement(Ne,{appContext:t}):i.a.createElement(i.a.Fragment,null),i.a.createElement("div",{className:"RouterContainer"},i.a.createElement(d.d,null,r?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.b,{path:"/create-narrative-context",element:i.a.createElement(J,{appContext:t})}),i.a.createElement(d.b,{path:"/narrative-context/:narrativeContextId/:narrativeCategoryId/:elementId",element:i.a.createElement(ge,{appContext:t})}),i.a.createElement(d.b,{path:"/narrative-context/:narrativeContextId",element:i.a.createElement(te,{appContext:t})}),i.a.createElement(d.b,{path:"/logout",element:i.a.createElement(Oe,{appContext:t})}),i.a.createElement(d.b,{path:"/",element:i.a.createElement(F,{appContext:t})}),i.a.createElement(d.b,{path:"*",element:i.a.createElement(d.a,{to:"/"})})):i.a.createElement(i.a.Fragment,null,i.a.createElement(d.b,{path:"/login",element:i.a.createElement(je,{appContext:t})}),i.a.createElement(d.b,{path:"*",element:i.a.createElement(d.a,{to:"/login"})}),i.a.createElement(d.b,{path:"/",element:i.a.createElement(d.a,{to:"/login"})}))))))}var Ie=function(){function e(){Object(b.a)(this,e),this.campaigns=null,this.worlds=null,this.campaigns=[],this.worlds=[]}return Object(y.a)(e,[{key:"getNarrativeContext",value:function(e){return this.campaigns.concat(this.worlds).find((function(t){return t.id===e}))}},{key:"addNarrativeContext",value:function(e){"world"===e.type?this.addWorld(e):this.addCampaign(e)}},{key:"removeNarrativeContext",value:function(e){var t=this.getNarrativeContext(e),n=null;(n="world"===t.type?this.worlds:this.campaigns).splice(n.indexOf(t),1)}},{key:"addWorld",value:function(e){this.worlds.push(e)}},{key:"addCampaign",value:function(e){this.campaigns.push(e)}},{key:"toJson",value:function(){return{campaigns:this.campaigns.map((function(e){return e.toJson()})),worlds:this.worlds.map((function(e){return e.toJson()}))}}},{key:"searchTerm",value:function(e,t){return this.getNarrativeContext(t).searchTerm(e)}}],[{key:"fromJson",value:function(t){var n=new e;return n.campaigns=t.campaigns.map((function(e){return R.fromJson(e)})),n.worlds=t.worlds.map((function(e){return R.fromJson(e)})),n}}]),e}(),Se=function(e){Object(_.a)(n,e);var t=Object(B.a)(n);function n(){return Object(b.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"pullDB",value:function(){var e=Object(o.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._get("/database");case 2:if(t=e.sent,0!==Object.keys(t).length){e.next=5;break}return e.abrupt("return",null);case 5:return e.abrupt("return",Ie.fromJson(t));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"pushDB",value:function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._post("/database",t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(ie),Te=function(){function e(){Object(b.a)(this,e),e._db=new Ie}return Object(y.a)(e,[{key:"tryGetCloudDB",value:function(){var t=Object(o.a)(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._tryDownloadCloudDB();case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"registerOnCloudDBDownloadedHook",value:function(t){e._onCloudDBDownloadedHooks.push(t)}},{key:"registerAfterSaveHook",value:function(t){e._afterSaveHooks.push(t)}},{key:"registerOnDirtyDBCallback",value:function(t){e._onDirtyDBCallback=t}},{key:"enableSavingPrevention",value:function(){e._preventSave=!0}},{key:"save",value:function(){e._save()}}],[{key:"_tryDownloadCloudDB",value:function(){var t=Object(o.a)(r.a.mark((function t(){var n,a,o;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Downloading remote DB"),t.next=3,e._dbSyncRepository.pullDB();case 3:if(n=t.sent){e._db=n,a=Object(k.a)(e._onCloudDBDownloadedHooks);try{for(a.s();!(o=a.n()).done;)(0,o.value)()}catch(r){a.e(r)}finally{a.f()}}case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"_save",value:function(){var t=Object(o.a)(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._preventSave){t.next=3;break}return e._onDirtyDBCallback(),t.abrupt("return");case 3:return e.setUpdatingDBIndicator(!0),t.next=6,e._dbSyncRepository.pushDB(e._db.toJson());case 6:e._callAfterSaveHooks(),e.setUpdatingDBIndicator(!1);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"_callAfterSaveHooks",value:function(){var t,n=Object(k.a)(e._afterSaveHooks);try{for(n.s();!(t=n.n()).done;){(0,t.value)()}}catch(a){n.e(a)}finally{n.f()}}}]),e}();Te._DB_KEY="db",Te._db=null,Te._afterSaveHooks=[],Te._preventSave=!1,Te._onDirtyDBCallback=function(){},Te._dbSyncRepository=new Se,Te._onCloudDBDownloadedHooks=[],Te.setUpdatingDBIndicator=function(e){};var Ae=function(){function e(){Object(b.a)(this,e),this._repositories=null,this._narrativeContextId=null,this.setUpdatingDBIndicator=function(e){},this.elementListItemExpandedStatuses={},this._repositories={}}return Object(y.a)(e,[{key:"getRepository",value:function(e){return this._repositories[e]||(this._repositories[e]=new e),this._repositories[e]}},{key:"setBackButtonUrl",value:function(e){}},{key:"setForwardButtonUrl",value:function(e){}},{key:"_setNarrativeContextById",value:function(e){}},{key:"setNarrativeContextById",value:function(e){this._narrativeContextId=e,this._setNarrativeContextById(e)}},{key:"getNarrativeContextId",value:function(){return this._narrativeContextId}},{key:"getDB",value:function(){return Te._db}},{key:"saveDBAsync",value:function(){var e=this;setTimeout((function(){return e.saveDB()}),0)}},{key:"saveDB",value:function(){var e=Object(o.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Te.setUpdatingDBIndicator=this.setUpdatingDBIndicator,e.prev=1,e.next=4,Te._save();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),alert("Ha ocurrido un error al tratar de enviar los cambios al servidor de la aplicaci\xf3n!");case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"showSearchBar",value:function(){}},{key:"hideSearchBar",value:function(){}},{key:"triggerEvent",value:function(e){"open_search"!==e?"close_search"!==e||this.hideSearchBar():this.showSearchBar()}},{key:"navigateToPreviousElement",value:function(){}},{key:"navigateToNextElement",value:function(){}}]),e}(),Pe=function(){function e(t){Object(b.a)(this,e),this._appContext=null,this._interval=null,this._INTERVAL_TIME=2e3,this._lastDBSaveTime=null,this._LAST_SAVE_DATE_KEY="last_save_date",this._appContext=t,this._lastDBSaveTime=this._getStoredDate(),this._registerAfterSaveHook(),this._registerOnDirtyDBCallback()}return Object(y.a)(e,[{key:"_registerAfterSaveHook",value:function(){var e=this;this._appContext.getRepository(Te).registerAfterSaveHook((function(){e._updateLastSaveInfo()}))}},{key:"_registerOnDirtyDBCallback",value:function(){var e=this;this._appContext.getRepository(Te).registerOnDirtyDBCallback((function(){e._onDirtyDB()}))}},{key:"_updateLastSaveInfo",value:function(){var e=new Date;this._lastDBSaveTime=e,localStorage.setItem(this._LAST_SAVE_DATE_KEY,e.toString())}},{key:"_getStoredDate",value:function(){var e=localStorage.getItem(this._LAST_SAVE_DATE_KEY);return e?new Date(e):null}},{key:"_isWorkingDirty",value:function(){var e=this._getStoredDate();return e&&!this._lastDBSaveTime||e&&this._lastDBSaveTime&&this._lastDBSaveTime<e}},{key:"start",value:function(){var e=this;this._interval=setInterval((function(){e._isWorkingDirty()&&(e._appContext.getRepository(Te).enableSavingPrevention(),clearInterval(e._interval),e._onDirtyDB())}),this._INTERVAL_TIME)}},{key:"_onDirtyDB",value:function(){window.confirm("Usted esta trabajando con una version desactualizada de la base de datos local y no podra guardar cambios en esta. Por favor recargue la aplicaci\xf3n para poder volver a utilizarla con normalidad o haga click en aceptar / ok para hacerlo autom\xe1ticamente.")&&window.location.reload()}}]),e}(),Re=function(){function e(t){var n=this;Object(b.a)(this,e),this._pressedKeys=[],this._tryRemovePressedKey=function(e){var t=n._pressedKeys.indexOf(e);-1!==t&&n._pressedKeys.splice(t,1)},this._appContext=t}return Object(y.a)(e,[{key:"_addPressedKey",value:function(e){this._pressedKeys.find((function(t){return t===e}))||this._pressedKeys.push(e)}},{key:"_keyPressed",value:function(e){return-1!==this._pressedKeys.indexOf(e)}},{key:"registerKeyboardShortcuts",value:function(){var e=this;document.addEventListener("keydown",(function(t){return e._addPressedKey(t.key),e._keyPressed("Control")&&"p"===t.key?(t.preventDefault(),void e._appContext.triggerEvent("open_search")):"Escape"!==t.key?e._keyPressed("Alt")&&"ArrowLeft"===t.key?(t.preventDefault(),void e._appContext.navigateToPreviousElement()):e._keyPressed("Alt")&&"ArrowRight"===t.key?(t.preventDefault(),void e._appContext.navigateToNextElement()):void 0:void e._appContext.triggerEvent("close_search")})),document.addEventListener("keyup",(function(t){e._tryRemovePressedKey(t.key)}))}}]),e}(),Ue=new Ae,Fe=new Pe(Ue),Je=new Re(Ue),Le=Ue.getRepository(Te),He=Ue.getRepository(be),Ye=function(){var e=Object(o.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!He.isAuthenticated()){e.next=4;break}return e.next=4,Le.tryGetCloudDB();case 4:Fe.start(),Je.registerKeyboardShortcuts(),u.a.render(i.a.createElement(De,{appContext:Ue}),document.getElementById("root")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),alert("Ha ocurrido un error al sincronizar con el servidor, por favor refresca la p\xe1gina!");case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();He.onLogin=function(){window.location="/"},He.onLogout=function(){window.location="/login"},Ye()}},[[53,1,2]]]);
//# sourceMappingURL=main.129b7252.chunk.js.map